(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{321:function(e,t,a){"use strict";a.r(t);var n=a(4),s=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"å‰ç«¯è¿›é˜¶ç®—æ³•2-ä»chrome-v8æºç çœ‹javascriptæ•°ç»„-é™„èµ è…¾è®¯é¢è¯•é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‰ç«¯è¿›é˜¶ç®—æ³•2-ä»chrome-v8æºç çœ‹javascriptæ•°ç»„-é™„èµ è…¾è®¯é¢è¯•é¢˜"}},[e._v("#")]),e._v(" å‰ç«¯è¿›é˜¶ç®—æ³•2ï¼šä»Chrome V8æºç çœ‹JavaScriptæ•°ç»„(é™„èµ è…¾è®¯é¢è¯•é¢˜)")]),e._v(" "),t("p",[e._v("åŸåˆ› å‰ç«¯ç“¶å­å› å‰ç«¯ç“¶å­å› "),t("em",[e._v("2020-04-02")])]),e._v(" "),t("h3",{attrs:{id:"ç®€ä»‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç®€ä»‹"}},[e._v("#")]),e._v(" ç®€ä»‹")]),e._v(" "),t("p",[e._v("æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—éƒ½æ˜¯çº¿æ€§è¡¨ï¼Œå®ƒè¡¨ç¤ºçš„ç»“æ„éƒ½æ˜¯ä¸€æ®µçº¿æ€§çš„ç»“æ„ï¼Œä¸ä¹‹å¯¹åº”çš„å°±æ˜¯éçº¿æ€§è¡¨ï¼Œä¾‹å¦‚æ ‘ã€å›¾ã€å †ç­‰ï¼Œå®ƒè¡¨ç¤ºçš„ç»“æ„éƒ½éçº¿æ€§ã€‚")]),e._v(" "),t("p",[e._v("æœ¬èŠ‚ä¸»è¦ä»‹ç» JavaScript æ•°ç»„ï¼Œåœ¨å¼€å§‹æœ¬ç« èŠ‚å‰ï¼Œæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š")]),e._v(" "),t("p",[e._v("æˆ‘ä»¬çŸ¥é“åœ¨ JavaScript ä¸­ï¼Œå¯ä»¥åœ¨æ•°ç»„ä¸­ä¿å­˜ä¸åŒç±»å‹å€¼ï¼Œå¹¶ä¸”æ•°ç»„å¯ä»¥åŠ¨æ€å¢é•¿ï¼Œä¸åƒå…¶å®ƒè¯­è¨€ï¼Œä¾‹å¦‚ Cï¼Œåˆ›å»ºçš„æ—¶å€™è¦å†³å®šæ•°ç»„çš„å¤§å°ï¼Œå¦‚æœæ•°ç»„æ»¡äº†ï¼Œå°±è¦é‡æ–°ç”³è¯·å†…å­˜ç©ºé—´ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå–ƒï¼Ÿ")]),e._v(" "),t("p",[e._v("æœ¬èŠ‚ä» Chrome v8 æºç è§’åº¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œåˆ†ä¸ºå››ä¸ªæ–¹é¢ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("æ•°ç»„åŸºç¡€å…¥é—¨")]),e._v(" "),t("li",[e._v("JavaScript ä¸­ï¼Œæ•°ç»„ä¸ºä»€ä¹ˆå¯ä»¥ä¿å­˜ä¸åŒç±»å‹ï¼Ÿ")]),e._v(" "),t("li",[e._v("JavaScript ä¸­ï¼Œæ•°ç»„æ˜¯å¦‚ä½•å­˜å‚¨çš„å–ƒï¼Ÿ")]),e._v(" "),t("li",[e._v("JavaScript ä¸­ï¼Œæ•°ç»„çš„åŠ¨æ€æ‰©å®¹ä¸å‡å®¹ï¼ˆ "),t("code",[e._v("FastElements")]),e._v(" ï¼‰")])]),e._v(" "),t("p",[e._v("ä¸‹é¢è¿›å…¥æ­£é¢˜å§ï¼ï¼ˆæ–‡æœ«æœ‰æƒŠå–œï¼‰ğŸ˜Š")]),e._v(" "),t("p",[e._v("æƒ³è¦æ›´å¤šæ›´å¿«çš„å­¦ä¹ æœ¬ç³»åˆ—ï¼Œå¯ä»¥å…³æ³¨å…¬ä¼—å·ã€Œå‰ç«¯ç“¶å­å›ã€å’Œæˆ‘çš„ã€ŒGithubï¼šhttps://github.com/sisterAn/JavaScript-Algorithmsã€")]),e._v(" "),t("h3",{attrs:{id:"ä¸€ã€æ•°ç»„-åŸºç¡€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€æ•°ç»„-åŸºç¡€"}},[e._v("#")]),e._v(" ä¸€ã€æ•°ç»„ï¼ˆåŸºç¡€ï¼‰")]),e._v(" "),t("p",[e._v("ä¸€ç§æœ€åŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œæ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½æœ‰ï¼Œå®ƒç¼–å·ä» 0 å¼€å§‹ï¼Œä»£è¡¨ä¸€ç»„è¿ç»­çš„å‚¨å­˜ç»“æ„ï¼Œç”¨æ¥å‚¨å­˜åŒä¸€ç§ç±»å‹çš„æ•°æ®ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("let arr = [1, 2, 3]\n")])])]),t("p",[e._v("å®ƒçš„è¿™ç§ç‰¹å®šçš„å­˜å‚¨ç»“æ„ï¼ˆè¿ç»­å­˜å‚¨ç©ºé—´å­˜å‚¨åŒä¸€ç±»å‹æ•°æ®ï¼‰å†³å®šäº†ï¼š")]),e._v(" "),t("p",[t("strong",[e._v("ä¼˜ç‚¹")])]),e._v(" "),t("ul",[t("li",[e._v("éšæœºè®¿é—®ï¼šå¯ä»¥é€šè¿‡ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„ä¸­çš„ä»»æ„ä½ç½®ä¸Šçš„æ•°æ®")])]),e._v(" "),t("p",[t("strong",[e._v("ç¼ºç‚¹")])]),e._v(" "),t("ul",[t("li",[e._v("å¯¹æ•°æ®çš„åˆ é™¤å’Œæ’å…¥ä¸æ˜¯å¾ˆå‹å¥½")])]),e._v(" "),t("p",[t("strong",[e._v("æŸ¥æ‰¾ï¼š")]),e._v(" æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼›")]),e._v(" "),t("p",[t("strong",[e._v("æ’å…¥æˆ–åˆ é™¤ï¼š")]),e._v(" æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼›")]),e._v(" "),t("p",[e._v("åœ¨ JavaScript ä¸­çš„æ•°ç»„å‡ ä¹æ˜¯ä¸‡èƒ½çš„ï¼Œå®ƒä¸å…‰å¯ä»¥ä½œä¸ºä¸€ä¸ªæ™®é€šçš„æ•°ç»„ä½¿ç”¨ï¼Œå¯ä»¥ä½œä¸ºæ ˆæˆ–é˜Ÿåˆ—ä½¿ç”¨ã€‚")]),e._v(" "),t("p",[e._v("æ•°ç»„ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("let array = [1, 2, 3]\n")])])]),t("p",[e._v("æ ˆï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("let stack = [1, 2, 3]\n// è¿›æ ˆ\nstack.push(4)\n// å‡ºæ ˆ\nstcak.pop()\n")])])]),t("p",[e._v("é˜Ÿåˆ—ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("let queue = [1, 2, 3]\n// è¿›é˜Ÿ\nqueue.push(4)\n// å‡ºé˜Ÿ\nqueue.shift()\n")])])]),t("h3",{attrs:{id:"äºŒã€javascript-ä¸­-æ•°ç»„å¯ä»¥ä¿å­˜ä¸åŒç±»å‹å€¼"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€javascript-ä¸­-æ•°ç»„å¯ä»¥ä¿å­˜ä¸åŒç±»å‹å€¼"}},[e._v("#")]),e._v(" äºŒã€JavaScript ä¸­ï¼Œæ•°ç»„å¯ä»¥ä¿å­˜ä¸åŒç±»å‹å€¼")]),e._v(" "),t("p",[e._v("çœ‹ä¸€ä¸‹ Chrome v8 æºç ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// The JSArray describes JavaScript Arrays\n//  Such an array can be in one of two modes:\n//    - fast, backing storage is a FixedArray and length <= elements.length();\n//       Please note: push and pop can be used to grow and shrink the array.\n//    - slow, backing storage is a HashTable with numbers as keys.\nclass JSArray: public JSObject {\n public:\n  // [length]: The length property.\n  DECL_ACCESSORS(length, Object)\n    \n  // ...\n   \n  // Number of element slots to pre-allocate for an empty array.\n  static const int kPreallocatedArrayElements = 4;\n};\n")])])]),t("p",[e._v("æˆ‘ä»¬å¯ä»¥çœ‹åˆ° "),t("code",[e._v("JSArray")]),e._v(" æ˜¯ç»§æ‰¿è‡ª "),t("code",[e._v("JSObject")]),e._v(" çš„ï¼Œæ‰€ä»¥åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„å¯ä»¥æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå†…éƒ¨ä¹Ÿæ˜¯ä»¥ key-value å½¢å¼å­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥ JavaScript ä¸­çš„æ•°ç»„å¯ä»¥å­˜æ”¾ä¸åŒç±»å‹çš„å€¼ã€‚")]),e._v(" "),t("h3",{attrs:{id:"ä¸‰ã€javascript-ä¸­-æ•°ç»„çš„å­˜å‚¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€javascript-ä¸­-æ•°ç»„çš„å­˜å‚¨"}},[e._v("#")]),e._v(" ä¸‰ã€JavaScript ä¸­ï¼Œæ•°ç»„çš„å­˜å‚¨")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// The JSArray describes JavaScript Arrays\n//  Such an array can be in one of two modes:\n//    - fast, backing storage is a FixedArray and length <= elements.length();\n//       Please note: push and pop can be used to grow and shrink the array.\n//    - slow, backing storage is a HashTable with numbers as keys.\nclass JSArray: public JSObject {\n public:\n  // [length]: The length property.\n  DECL_ACCESSORS(length, Object)\n    \n  // ...\n   \n  // Number of element slots to pre-allocate for an empty array.\n  static const int kPreallocatedArrayElements = 4;\n};\n")])])]),t("p",[t("code",[e._v("JSArray")]),e._v(" ç»§æ‰¿äº "),t("code",[e._v("JSObject")]),e._v(" ï¼Œä»æ³¨é‡Šä¸Šçœ‹ï¼Œå®ƒæœ‰ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("fastï¼šå­˜å‚¨ç»“æ„æ˜¯ "),t("code",[e._v("FixedArray")]),e._v(" ï¼Œå¹¶ä¸”æ•°ç»„é•¿åº¦ "),t("code",[e._v("<= elements.length()")]),e._v(" ï¼Œ"),t("code",[e._v("push")]),e._v(" æˆ– "),t("code",[e._v("pop")]),e._v(" æ—¶å¯èƒ½ä¼šä¼´éšç€åŠ¨æ€æ‰©å®¹æˆ–å‡å®¹")]),e._v(" "),t("li",[e._v("slowï¼šå­˜å‚¨ç»“æ„æ˜¯ "),t("code",[e._v("HashTable")]),e._v("ï¼ˆå“ˆå¸Œè¡¨ï¼‰ï¼Œå¹¶ä¸”æ•°ç»„ä¸‹æ ‡ä½œä¸º "),t("code",[e._v("key")])])]),e._v(" "),t("p",[t("code",[e._v("fast")]),e._v(" æ¨¡å¼ä¸‹æ•°ç»„åœ¨æºç é‡Œé¢å« "),t("code",[e._v("FastElements")]),e._v(" ï¼Œè€Œ "),t("code",[e._v("slow")]),e._v(" æ¨¡å¼ä¸‹çš„å«åš "),t("code",[e._v("SlowElements")]),e._v(" ã€‚")]),e._v(" "),t("h4",{attrs:{id:"_1-å¿«æ•°ç»„-fastelements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å¿«æ•°ç»„-fastelements"}},[e._v("#")]),e._v(" 1. å¿«æ•°ç»„ï¼ˆFastElementsï¼‰")]),e._v(" "),t("p",[t("code",[e._v("FixedArray")]),e._v(" æ˜¯ V8 å®ç°çš„ä¸€ä¸ªç±»ä¼¼äºæ•°ç»„çš„ç±»ï¼Œå®ƒè¡¨ç¤ºä¸€æ®µè¿ç»­çš„å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•ç›´æ¥å®šä½ã€‚æ–°åˆ›å»ºçš„ç©ºæ•°ç»„é»˜è®¤å°±æ˜¯å¿«æ•°ç»„ã€‚å½“æ•°ç»„æ»¡ï¼ˆæ•°ç»„çš„é•¿åº¦è¾¾åˆ°æ•°ç»„åœ¨å†…å­˜ä¸­ç”³è¯·çš„å†…å­˜å®¹é‡æœ€å¤§å€¼ï¼‰çš„æ—¶å€™ï¼Œç»§ç»­ "),t("code",[e._v("push")]),e._v(" æ—¶ï¼Œ "),t("code",[e._v("JSArray")]),e._v(" ä¼šè¿›è¡ŒåŠ¨æ€çš„æ‰©å®¹ï¼Œä»¥å­˜å‚¨æ›´å¤šçš„å…ƒç´ ã€‚")]),e._v(" "),t("h4",{attrs:{id:"_2-æ…¢æ•°ç»„-slowelements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ…¢æ•°ç»„-slowelements"}},[e._v("#")]),e._v(" 2. æ…¢æ•°ç»„ï¼ˆSlowElementsï¼‰")]),e._v(" "),t("p",[e._v("æ…¢æ•°ç»„ä»¥å“ˆå¸Œè¡¨çš„å½¢å¼å­˜å‚¨åœ¨å†…å­˜ç©ºé—´é‡Œï¼Œå®ƒä¸éœ€è¦å¼€è¾Ÿè¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œä½†éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œä¸å¿«æ•°ç»„ç›¸æ¯”ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// src/objects/dictionary.h\nclass EXPORT_TEMPLATE_DECLARE(V8_EXPORT_PRIVATE) Dictionary\n    : public HashTable<Derived, Shape> {\n  using DerivedHashTable = HashTable<Derived, Shape>;\n\n public:\n  using Key = typename Shape::Key;\n  // Returns the value at entry.\n  inline Object ValueAt(InternalIndex entry);\n  inline Object ValueAt(const Isolate* isolate, InternalIndex entry);\n  \n  // ...\n};\n")])])]),t("p",[e._v("ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®ƒçš„å†…éƒ¨å°±æ˜¯ä¸€ä¸ª HashTableã€‚")]),e._v(" "),t("h4",{attrs:{id:"_3-ä»€ä¹ˆæ—¶å€™ä¼šä»-fast-è½¬å˜ä¸º-slow-å–ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä»€ä¹ˆæ—¶å€™ä¼šä»-fast-è½¬å˜ä¸º-slow-å–ƒ"}},[e._v("#")]),e._v(" 3. ä»€ä¹ˆæ—¶å€™ä¼šä» fast è½¬å˜ä¸º slow å–ƒï¼Ÿ")]),e._v(" "),t("p",[e._v("ä» Chrome V8 æºç ä¸Šçœ‹ï¼Œ")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// src/objects/js-objects.h\nstatic const uint32_t kMaxGap = 1024;\n\n// src/objects/dictionary.h\n// JSObjects prefer dictionary elements if the dictionary saves this much\n// memory compared to a fast elements backing store.\nstatic const uint32_t kPreferFastElementsSizeFactor = 3;\n\n// src/objects/js-objects-inl.h\n// If the fast-case backing storage takes up much more memory than a dictionary\n// backing storage would, the object should have slow elements.\n// static\nstatic inline bool ShouldConvertToSlowElements(uint32_t used_elements,\n                                               uint32_t new_capacity) {\n  uint32_t size_threshold = NumberDictionary::kPreferFastElementsSizeFactor *\n                            NumberDictionary::ComputeCapacity(used_elements) *\n                            NumberDictionary::kEntrySize;\n  // å¿«æ•°ç»„æ–°å®¹é‡æ˜¯æ‰©å®¹åçš„å®¹é‡3å€ä¹‹å¤šæ—¶ï¼Œä¹Ÿä¼šè¢«è½¬æˆæ…¢æ•°ç»„\n  return size_threshold <= new_capacity;\n}\n\nstatic inline bool ShouldConvertToSlowElements(JSObject object,\n                                               uint32_t capacity,\n                                               uint32_t index,\n                                               uint32_t* new_capacity) {\n  STATIC_ASSERT(JSObject::kMaxUncheckedOldFastElementsLength <=\n                JSObject::kMaxUncheckedFastElementsLength);\n  if (index < capacity) {\n    *new_capacity = capacity;\n    return false;\n  }\n  // å½“åŠ å…¥çš„ç´¢å¼•å€¼ï¼ˆä¾‹å¦‚ä¾‹3ä¸­çš„2000ï¼‰æ¯”å½“å‰å®¹é‡capacity å¤§äºç­‰äº 1024æ—¶ï¼Œ\n  // è¿”å›trueï¼Œè½¬ä¸ºæ…¢æ•°ç»„\n  if (index - capacity >= JSObject::kMaxGap) return true;\n  *new_capacity = JSObject::NewElementsCapacity(index + 1);\n  DCHECK_LT(index, *new_capacity);\n  // TODO(ulan): Check if it works with young large objects.\n  if (*new_capacity <= JSObject::kMaxUncheckedOldFastElementsLength ||\n      (*new_capacity <= JSObject::kMaxUncheckedFastElementsLength &&\n       ObjectInYoungGeneration(object))) {\n    return false;\n  }\n  return ShouldConvertToSlowElements(object.GetFastElementsUsage(),\n                                     *new_capacity);\n}\n")])])]),t("p",[e._v("æ‰€ä»¥ï¼Œå½“å¤„äºä»¥ä¸‹æƒ…å†µæ—¶ï¼Œå¿«æ•°ç»„ä¼šè¢«è½¬å˜ä¸ºæ…¢æ•°ç»„ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("å½“åŠ å…¥çš„ç´¢å¼•å€¼ index æ¯”å½“å‰å®¹é‡ capacity å·®å€¼å¤§äºç­‰äº 1024 æ—¶ï¼ˆindex - capacity >= 1024ï¼‰")]),e._v(" "),t("li",[e._v("å¿«æ•°ç»„æ–°å®¹é‡æ˜¯æ‰©å®¹åçš„å®¹é‡ 3 å€ä¹‹å¤šæ—¶")])]),e._v(" "),t("p",[e._v("ä¾‹å¦‚ï¼šå‘å¿«æ•°ç»„é‡Œå¢åŠ ä¸€ä¸ªå¤§ç´¢å¼•åŒç±»å‹å€¼")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var arr = [1, 2, 3]\narr[2000] = 10;\n")])])]),t("p",[e._v("å½“å¾€ "),t("code",[e._v("arr")]),e._v(" å¢åŠ ä¸€ä¸ª "),t("code",[e._v("2000")]),e._v(" çš„ç´¢å¼•æ—¶ï¼Œ"),t("code",[e._v("arr")]),e._v(" è¢«è½¬æˆæ…¢æ•°ç»„ã€‚èŠ‚çœäº†å¤§é‡çš„å†…å­˜ç©ºé—´ï¼ˆä»ç´¢å¼•ä¸º 2 åˆ°ç´¢å¼•ä¸º 2000ï¼‰ã€‚")]),e._v(" "),t("h4",{attrs:{id:"_4-ä»€ä¹ˆæ—¶å€™ä¼šä»-slow-è½¬å˜ä¸º-fast-å–ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-ä»€ä¹ˆæ—¶å€™ä¼šä»-slow-è½¬å˜ä¸º-fast-å–ƒ"}},[e._v("#")]),e._v(" 4. ä»€ä¹ˆæ—¶å€™ä¼šä» slow è½¬å˜ä¸º fast å–ƒï¼Ÿ")]),e._v(" "),t("p",[e._v("æˆ‘ä»¬å·²ç»çŸ¥é“åœ¨ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°ç”±å¿«å˜æ…¢ï¼Œé‚£ç”±æ…¢å˜å¿«å°±å¾ˆç®€å•äº†")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("static bool ShouldConvertToFastElements(JSObject object,\n                                        NumberDictionary dictionary,\n                                        uint32_t index,\n                                        uint32_t* new_capacity) {\n  // If properties with non-standard attributes or accessors were added, we\n  // cannot go back to fast elements.\n  if (dictionary.requires_slow_elements()) return false;\n  // Adding a property with this index will require slow elements.\n  if (index >= static_cast<uint32_t>(Smi::kMaxValue)) return false;\n  if (object.IsJSArray()) {\n    Object length = JSArray::cast(object).length();\n    if (!length.IsSmi()) return false;\n    *new_capacity = static_cast<uint32_t>(Smi::ToInt(length));\n  } else if (object.IsJSArgumentsObject()) {\n    return false;\n  } else {\n    *new_capacity = dictionary.max_number_key() + 1;\n  }\n  *new_capacity = Max(index + 1, *new_capacity);\n  uint32_t dictionary_size = static_cast<uint32_t>(dictionary.Capacity()) *\n                             NumberDictionary::kEntrySize;\n  // Turn fast if the dictionary only saves 50% space.\n  return 2 * dictionary_size >= *new_capacity;\n}\n")])])]),t("p",[e._v("å½“æ…¢æ•°ç»„çš„å…ƒç´ å¯å­˜æ”¾åœ¨å¿«æ•°ç»„ä¸­ä¸”é•¿åº¦åœ¨ smi ä¹‹é—´ä¸”ä»…èŠ‚çœäº†50%çš„ç©ºé—´ï¼Œåˆ™ä¼šè½¬å˜ä¸ºå¿«æ•°ç»„")]),e._v(" "),t("h3",{attrs:{id:"å››ã€javascript-ä¸­-æ•°ç»„çš„åŠ¨æ€æ‰©å®¹ä¸å‡å®¹-fastelements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€javascript-ä¸­-æ•°ç»„çš„åŠ¨æ€æ‰©å®¹ä¸å‡å®¹-fastelements"}},[e._v("#")]),e._v(" å››ã€JavaScript ä¸­ï¼Œæ•°ç»„çš„åŠ¨æ€æ‰©å®¹ä¸å‡å®¹ï¼ˆFastElementsï¼‰")]),e._v(" "),t("p",[e._v("é»˜è®¤ç©ºæ•°ç»„åˆå§‹åŒ–å¤§å°ä¸º "),t("code",[e._v("4")]),e._v(" :")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// Number of element slots to pre-allocate for an empty array.\nstatic const int kPreallocatedArrayElements = 4;\n")])])]),t("p",[e._v("åœ¨ JavaScript ä¸­ï¼Œå½“æ•°ç»„æ‰§è¡Œ "),t("code",[e._v("push")]),e._v(" æ“ä½œæ—¶ï¼Œä¸€æ—¦å‘ç°æ•°ç»„å†…å­˜ä¸è¶³ï¼Œå°†è¿›è¡Œæ‰©å®¹ã€‚")]),e._v(" "),t("p",[e._v("åœ¨ Chrome æºç ä¸­ï¼Œ "),t("code",[e._v("push")]),e._v(" çš„æ“ä½œæ˜¯ç”¨æ±‡ç¼–å®ç°çš„ï¼Œåœ¨ c++ é‡ŒåµŒå…¥çš„æ±‡ç¼–ï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œå¹¶ä¸”åœ¨æ±‡ç¼–çš„åŸºç¡€ä¸Šç”¨ c++ å°è£…äº†ä¸€å±‚ï¼Œåœ¨ç¼–è¯‘æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå°†è¿™äº› c++ ä»£ç è½¬æˆæ±‡ç¼–ä»£ç ã€‚")]),e._v(" "),t("p",[e._v("è®¡ç®—æ–°å®¹é‡çš„å‡½æ•°ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// js-objects.h\nstatic const uint32_t kMinAddedElementsCapacity = 16;\n\n// code-stub-assembler.cc\nNode* CodeStubAssembler::CalculateNewElementsCapacity(Node* old_capacity,\n                                                      ParameterMode mode) {\n  CSA_SLOW_ASSERT(this, MatchesParameterMode(old_capacity, mode));\n  Node* half_old_capacity = WordOrSmiShr(old_capacity, 1, mode);\n  Node* new_capacity = IntPtrOrSmiAdd(half_old_capacity, old_capacity, mode);\n  Node* padding =\n      IntPtrOrSmiConstant(JSObject::kMinAddedElementsCapacity, mode);\n  return IntPtrOrSmiAdd(new_capacity, padding, mode);\n}\n")])])]),t("p",[e._v("æ‰€ä»¥æ‰©å®¹åæ–°å®¹é‡è®¡å…¬å¼ä¸ºï¼š")]),e._v(" "),t("blockquote",[t("p",[e._v("new_capacity = old_capacity /2 + old_capacity + 16")])]),e._v(" "),t("p",[e._v("å³è€çš„å®¹é‡çš„ 1.5 å€åŠ ä¸Š 16 ã€‚åˆå§‹åŒ–ä¸º 4 ä¸ªï¼Œå½“ "),t("code",[e._v("push")]),e._v(" ç¬¬ 5 ä¸ªçš„æ—¶å€™ï¼Œå®¹é‡å°†ä¼šå˜æˆï¼š")]),e._v(" "),t("blockquote",[t("p",[e._v("new_capacity = 4 / 2 + 4 + 16 = 22")])]),e._v(" "),t("p",[e._v("æ¥ç€ç”³è¯·ä¸€å—è¿™ä¹ˆå¤§çš„å†…å­˜ï¼ŒæŠŠè€çš„æ•°æ®æ‹·è¿‡å»ï¼ŒæŠŠæ–°å…ƒç´ æ”¾åœ¨å½“å‰ length ä½ç½®ï¼Œç„¶åå°†æ•°ç»„çš„ length + 1ï¼Œå¹¶è¿”å› lengthã€‚")]),e._v(" "),t("p",[e._v("æ‰€ä»¥ï¼Œæ‰©å®¹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("push")]),e._v(" æ“ä½œæ—¶ï¼Œå‘ç°æ•°ç»„å†…å­˜ä¸è¶³")]),e._v(" "),t("li",[e._v("ç”³è¯· new_capacity = old_capacity /2 + old_capacity + 16 é‚£ä¹ˆé•¿åº¦çš„å†…å­˜ç©ºé—´")]),e._v(" "),t("li",[e._v("å°†æ•°ç»„æ‹·è´åˆ°æ–°å†…å­˜ä¸­")]),e._v(" "),t("li",[e._v("æŠŠæ–°å…ƒç´ æ”¾åœ¨å½“å‰ length ä½ç½®")]),e._v(" "),t("li",[e._v("æ•°ç»„çš„ length + 1")]),e._v(" "),t("li",[e._v("è¿”å› length")])]),e._v(" "),t("p",[e._v("æ•´ä¸ªè¿‡ç¨‹ï¼Œç”¨æˆ·æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œä¸åƒ Cï¼Œéœ€ç”¨ç”¨æˆ·æ‰‹åŠ¨ç”³è¯·å†…å­˜ç©ºé—´ã€‚")]),e._v(" "),t("p",[e._v("å½“æ•°ç»„æ‰§è¡Œ "),t("code",[e._v("pop")]),e._v(" æ“ä½œæ—¶ï¼Œä¼šåˆ¤æ–­ "),t("code",[e._v("pop")]),e._v(" åæ•°ç»„çš„å®¹é‡ï¼Œæ˜¯å¦éœ€è¦è¿›è¡Œå‡å®¹ã€‚")]),e._v(" "),t("p",[e._v("ä¸åŒäºæ•°ç»„çš„ "),t("code",[e._v("push")]),e._v(" ä½¿ç”¨æ±‡ç¼–å®ç°çš„ï¼Œ "),t("code",[e._v("pop")]),e._v(" ä½¿ç”¨ c++ å®ç°çš„ã€‚")]),e._v(" "),t("p",[e._v("åˆ¤æ–­æ˜¯å¦è¿›è¡Œå‡å®¹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("if (2 * length <= capacity) {\n  // If more than half the elements won't be used, trim the array.\n  isolate->heap()->RightTrimFixedArray(*backing_store, capacity - length);\n} else {\n  // Otherwise, fill the unused tail with holes.\n  BackingStore::cast(*backing_store)->FillWithHoles(length, old_length);\n}\n")])])]),t("p",[e._v("æ‰€ä»¥ï¼Œå½“æ•°ç»„ "),t("code",[e._v("pop")]),e._v(" åï¼Œå¦‚æœæ•°ç»„å®¹é‡å¤§äºç­‰äº length çš„ 2 å€ï¼Œåˆ™è¿›è¡Œå®¹é‡è°ƒæ•´ï¼Œä½¿ç”¨ "),t("code",[e._v("RightTrimFixedArray")]),e._v(" å‡½æ•°ï¼Œè®¡ç®—å‡ºéœ€è¦é‡Šæ”¾çš„ç©ºé—´å¤§å°ï¼Œåšå¥½æ ‡è®°ï¼Œç­‰å¾… GC å›æ”¶ï¼›å¦‚æœæ•°ç»„å®¹é‡å°äº length çš„ 2 å€ï¼Œåˆ™ç”¨ holes å¯¹è±¡å¡«å……ã€‚")]),e._v(" "),t("p",[e._v("æ‰€ä»¥ï¼Œå‡å®¹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("pop")]),e._v(" æ“ä½œæ—¶ï¼Œè·å–æ•°ç»„ "),t("code",[e._v("length")])]),e._v(" "),t("li",[e._v("è·å– "),t("code",[e._v("length - 1")]),e._v(" ä¸Šçš„å…ƒç´ ï¼ˆè¦åˆ é™¤çš„å…ƒç´ ï¼‰")]),e._v(" "),t("li",[e._v("æ•°ç»„ "),t("code",[e._v("length - 1")])]),e._v(" "),t("li",[e._v("åˆ¤æ–­æ•°ç»„çš„æ€»å®¹é‡æ˜¯å¦å¤§äºç­‰äº length - 1 çš„ 2 å€")]),e._v(" "),t("li",[e._v("æ˜¯çš„è¯ï¼Œä½¿ç”¨ "),t("code",[e._v("RightTrimFixedArray")]),e._v(" å‡½æ•°ï¼Œè®¡ç®—å‡ºéœ€è¦é‡Šæ”¾çš„ç©ºé—´å¤§å°ï¼Œå¹¶åšå¥½æ ‡è®°ï¼Œç­‰å¾… "),t("code",[e._v("GC")]),e._v(" å›æ”¶")]),e._v(" "),t("li",[e._v("ä¸æ˜¯çš„è¯ï¼Œç”¨ "),t("code",[e._v("holes")]),e._v(" å¯¹è±¡å¡«å……")]),e._v(" "),t("li",[e._v("è¿”å›è¦åˆ é™¤çš„å…ƒç´ ")])]),e._v(" "),t("h3",{attrs:{id:"äº”ã€è§£ç­”å¼€ç¯‡é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº”ã€è§£ç­”å¼€ç¯‡é—®é¢˜"}},[e._v("#")]),e._v(" äº”ã€è§£ç­”å¼€ç¯‡é—®é¢˜")]),e._v(" "),t("p",[e._v("JavaScript ä¸­ï¼Œ "),t("code",[e._v("JSArray")]),e._v(" ç»§æ‰¿è‡ª "),t("code",[e._v("JSObject")]),e._v(" ï¼Œæˆ–è€…è¯´å®ƒå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå†…éƒ¨æ˜¯ä»¥ key-value å½¢å¼å­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥ JavaScript ä¸­çš„æ•°ç»„å¯ä»¥å­˜æ”¾ä¸åŒç±»å‹çš„å€¼ã€‚å®ƒæœ‰ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼Œå¿«æ•°ç»„ä¸æ…¢æ•°ç»„ï¼Œåˆå§‹åŒ–ç©ºæ•°ç»„æ—¶ï¼Œä½¿ç”¨å¿«æ•°ç»„ï¼Œå¿«æ•°ç»„ä½¿ç”¨è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå½“æ•°ç»„é•¿åº¦è¾¾åˆ°æœ€å¤§æ—¶ï¼Œ"),t("code",[e._v("JSArray")]),e._v(" ä¼šè¿›è¡ŒåŠ¨æ€çš„æ‰©å®¹ï¼Œä»¥å­˜å‚¨æ›´å¤šçš„å…ƒç´ ï¼Œç›¸å¯¹æ…¢æ•°ç»„ï¼Œæ€§èƒ½è¦å¥½å¾—å¤šã€‚å½“æ•°ç»„ä¸­ "),t("code",[e._v("hole")]),e._v(" å¤ªå¤šæ—¶ï¼Œä¼šè½¬å˜æˆæ…¢æ•°ç»„ï¼Œå³ä»¥å“ˆå¸Œè¡¨çš„æ–¹å¼ï¼ˆ key-value çš„å½¢å¼ï¼‰å­˜å‚¨æ•°æ®ï¼Œä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚")]),e._v(" "),t("h3",{attrs:{id:"å…­ã€æœ€åé™„èµ ä¸€é“å‰ç«¯é¢è¯•é¢˜-è…¾è®¯-æ•°ç»„æ‰å¹³åŒ–ã€å»é‡ã€æ’åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…­ã€æœ€åé™„èµ ä¸€é“å‰ç«¯é¢è¯•é¢˜-è…¾è®¯-æ•°ç»„æ‰å¹³åŒ–ã€å»é‡ã€æ’åº"}},[e._v("#")]),e._v(" å…­ã€æœ€åé™„èµ ä¸€é“å‰ç«¯é¢è¯•é¢˜ï¼ˆè…¾è®¯ï¼‰ï¼šæ•°ç»„æ‰å¹³åŒ–ã€å»é‡ã€æ’åº")]),e._v(" "),t("p",[e._v("å…³äº "),t("code",[e._v("Array")]),e._v(" çš„å±æ€§ã€æ–¹æ³•è¿™é‡Œä¸å†åšä»‹ç»ï¼Œè¯¦çœ‹ MDN Array ã€‚")]),e._v(" "),t("p",[e._v("é¢è¯•é¢˜ï¼š")]),e._v(" "),t("blockquote",[t("p",[e._v("å·²çŸ¥å¦‚ä¸‹æ•°ç»„ï¼švar arr = [ [1, 2, 2], [3, 4, 5, 5], [6, 7, 8, 9, [11, 12, [12, 13, [14] ] ] ], 10];")]),e._v(" "),t("p",[e._v("ç¼–å†™ä¸€ä¸ªç¨‹åºå°†æ•°ç»„æ‰å¹³åŒ–å»å¹¶é™¤å…¶ä¸­é‡å¤éƒ¨åˆ†æ•°æ®ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå‡åºä¸”ä¸é‡å¤çš„æ•°ç»„")])]),e._v(" "),t("p",[e._v("ç­”æ¡ˆï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("var arr = [ [1, 2, 2], [3, 4, 5, 5], [6, 7, 8, 9, [11, 12, [12, 13, [14] ] ] ], 10]\n// æ‰å¹³åŒ–\nlet flatArr = arr.flat(4)\n// å»é‡\nlet disArr = Array.from(new Set(flatArr))\n// æ’åº\nlet result = disArr.sort(function(a, b) {\n    return a-b\n})\nconsole.log(result)\n// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]\n")])])]),t("p",[e._v("å…³äº Set è¯·æŸ¥é˜… Setã€WeakSetã€MapåŠWeakMap")]),e._v(" "),t("p",[e._v("å‚è€ƒé“¾æ¥ï¼š")]),e._v(" "),t("p",[e._v("æ¢ç©¶JS V8å¼•æ“ä¸‹çš„â€œæ•°ç»„â€åº•å±‚å®ç°")]),e._v(" "),t("p",[e._v("ä»Chromeæºç çœ‹JS Arrayçš„å®ç°")]),e._v(" "),t("h3",{attrs:{id:"ä¸ƒã€è®¤è¯†æ›´å¤šçš„å‰ç«¯é“å‹-ä¸€èµ·è¿›é˜¶å‰ç«¯å¼€å‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ƒã€è®¤è¯†æ›´å¤šçš„å‰ç«¯é“å‹-ä¸€èµ·è¿›é˜¶å‰ç«¯å¼€å‘"}},[e._v("#")]),e._v(" ä¸ƒã€è®¤è¯†æ›´å¤šçš„å‰ç«¯é“å‹ï¼Œä¸€èµ·è¿›é˜¶å‰ç«¯å¼€å‘")]),e._v(" "),t("p",[e._v("å‰ç«¯ç®—æ³•é›†è®­è¥ç¬¬ä¸€æœŸå¼€è¥å•¦ğŸ‰ğŸ‰ğŸ‰")]),e._v(" "),t("p",[e._v("åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥å’Œå¿—åŒé“åˆçš„å‰ç«¯æœ‹å‹ä»¬ä¸€èµ·è¿›é˜¶å‰ç«¯ç®—æ³•ï¼Œä»0åˆ°1æ„å»ºå®Œæ•´çš„æ•°æ®ç»“æ„ä¸ç®—æ³•ä½“ç³»ã€‚")]),e._v(" "),t("p",[e._v("æ‰«ç åŠ å…¥ã€å‰ç«¯ç®—æ³•äº¤æµç¾¤äº¤æµç¾¤")])])}),[],!1,null,null,null);t.default=s.exports}}]);