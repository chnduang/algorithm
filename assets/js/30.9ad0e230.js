(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{322:function(e,n,t){"use strict";t.r(n);var d=t(4),o=Object(d.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"diffç®—æ³•çœ‹ä¸æ‡‚å°±ä¸€èµ·æ¥é”¤æˆ‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diffç®—æ³•çœ‹ä¸æ‡‚å°±ä¸€èµ·æ¥é”¤æˆ‘"}},[e._v("#")]),e._v(" DIffç®—æ³•çœ‹ä¸æ‡‚å°±ä¸€èµ·æ¥é”¤æˆ‘")]),e._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/vAt4oCMwa8Bsd3Wb2YfrYg",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://mp.weixin.qq.com/s/vAt4oCMwa8Bsd3Wb2YfrYg"),n("OutboundLink")],1)])]),e._v(" "),n("h1",{attrs:{id:"å‰è¨€"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[e._v("#")]),e._v(" å‰è¨€")]),e._v(" "),n("p",[e._v('é¢è¯•å®˜:"ä½ äº†è§£'),n("code",[e._v("è™šæ‹ŸDOM(Virtual DOM)")]),e._v("è·Ÿ"),n("code",[e._v("Diffç®—æ³•")]),e._v('å—,è¯·æè¿°ä¸€ä¸‹å®ƒä»¬";')]),e._v(" "),n("p",[e._v('æˆ‘:"é¢,...é¹…,é‚£ä¸ª",å®Œäº†ğŸ˜°,çªç„¶æ™ºå•†ä¸åœ¨çº¿,æ²¡ç»„ç»‡å¥½è¯­è¨€æ²¡ç­”å¥½æˆ–è€…å‹æ ¹å°±ç­”ä¸å‡ºæ¥;')]),e._v(" "),n("p",[e._v("æ‰€ä»¥è¿™æ¬¡æˆ‘æ€»ç»“ä¸€ä¸‹ç›¸å…³çš„çŸ¥è¯†ç‚¹,è®©ä½ å¯ä»¥æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤çŸ¥ä¹‹ä½™ä¹Ÿä¼šè®©ä½ åœ¨ä»Šåé‡åˆ°è¿™ç§æƒ…å†µå¯ä»¥"),n("strong",[e._v("å¦ç„¶è‡ªè‹¥,åº”ä»˜è‡ªå¦‚,æ¸¸åˆƒæœ‰ä½™")]),e._v(":")]),e._v(" "),n("hr"),e._v(" "),n("h2",{attrs:{id:"ç›¸å…³çŸ¥è¯†ç‚¹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç›¸å…³çŸ¥è¯†ç‚¹"}},[e._v("#")]),e._v(" ç›¸å…³çŸ¥è¯†ç‚¹:")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("è™šæ‹ŸDOM(Virtual DOM):")])]),e._v(" "),n("li",[n("ul",[n("li",[n("strong",[e._v("ä»€ä¹ˆæ˜¯è™šæ‹Ÿdom")])]),e._v(" "),n("li",[n("strong",[e._v("ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿdom")])]),e._v(" "),n("li",[e._v("è™šæ‹ŸDOMåº“")])])]),e._v(" "),n("li",[n("p",[e._v("DIFFç®—æ³•:")])]),e._v(" "),n("li",[n("ul",[n("li",[e._v("initå‡½æ•°")]),e._v(" "),n("li",[e._v("hå‡½æ•°")]),e._v(" "),n("li",[n("strong",[e._v("patchå‡½æ•°")])]),e._v(" "),n("li",[n("strong",[e._v("patchVnodeå‡½æ•°")])]),e._v(" "),n("li",[n("strong",[e._v("updateChildrenå‡½æ•°")])]),e._v(" "),n("li",[e._v("snabbDomæºç ")])])])]),e._v(" "),n("hr"),e._v(" "),n("h2",{attrs:{id:"è™šæ‹Ÿdom-virtual-dom"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è™šæ‹Ÿdom-virtual-dom"}},[e._v("#")]),e._v(" è™šæ‹ŸDOM(Virtual DOM)")]),e._v(" "),n("h3",{attrs:{id:"ä»€ä¹ˆæ˜¯è™šæ‹Ÿdom"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯è™šæ‹Ÿdom"}},[e._v("#")]),e._v(" ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM")]),e._v(" "),n("p",[e._v("ä¸€å¥è¯æ€»ç»“è™šæ‹ŸDOMå°±æ˜¯ä¸€ä¸ªç”¨æ¥æè¿°çœŸå®DOMçš„"),n("strong",[e._v("javaScriptå¯¹è±¡")]),e._v(",è¿™æ ·è¯´å¯èƒ½ä¸å¤Ÿå½¢è±¡,é‚£æˆ‘ä»¬æ¥ä¸¾ä¸ªğŸŒ°:åˆ†åˆ«ç”¨ä»£ç æ¥æè¿°"),n("code",[e._v("çœŸå®DOM")]),e._v("ä»¥åŠ"),n("code",[e._v("è™šæ‹ŸDOM")])]),e._v(" "),n("p",[n("code",[e._v("çœŸå®DOM")]),e._v(":")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('<ul class="list">\n    <li>a</li>\n    <li>b</li>\n    <li>c</li>\n</ul>\nå¤åˆ¶ä»£ç \n')])])]),n("p",[n("code",[e._v("å¯¹åº”çš„è™šæ‹ŸDOM")]),e._v(":")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("let vnode = h('ul.list', [\n  h('li','a'),\n  h('li','b'),\n  h('li','c'),\n])\n\nconsole.log(vnode)\nå¤åˆ¶ä»£ç \n")])])]),n("h4",{attrs:{id:"æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„vnode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„vnode"}},[e._v("#")]),e._v(" æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„"),n("strong",[e._v("Vnode")]),e._v(":")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLfDQbT3YnicB8GCBnDpF4K3uCL9yt7F05tKuwS1kxMIrAkLcCic7zK2Dw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("h4",{attrs:{id:"hå‡½æ•°ç”Ÿæˆçš„è™šæ‹Ÿdomè¿™ä¸ªjså¯¹è±¡-vnode-çš„æºç "}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hå‡½æ•°ç”Ÿæˆçš„è™šæ‹Ÿdomè¿™ä¸ªjså¯¹è±¡-vnode-çš„æºç "}},[e._v("#")]),e._v(" hå‡½æ•°ç”Ÿæˆçš„è™šæ‹ŸDOMè¿™ä¸ªJSå¯¹è±¡(Vnode)çš„æºç :")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("export interface VNodeData {\n    props?: Props\n    attrs?: Attrs\n    class?: Classes\n    style?: VNodeStyle\n    dataset?: Dataset\n    on?: On\n    hero?: Hero\n    attachData?: AttachData\n    hook?: Hooks\n    key?: Key\n    ns?: string // for SVGs\n    fn?: () => VNode // for thunks\n    args?: any[] // for thunks\n    [key: string]: any // for any other 3rd party module\n}\n\nexport type Key = string | number\n\nconst interface VNode = {\n    sel: string | undefined, // é€‰æ‹©å™¨\n    data: VNodeData | undefined, // VNodeDataä¸Šé¢å®šä¹‰çš„VNodeData\n    children: Array<VNode | string> | undefined, //å­èŠ‚ç‚¹,ä¸textäº’æ–¥\n    text: string | undefined, // æ ‡ç­¾ä¸­é—´çš„æ–‡æœ¬å†…å®¹\n    elm: Node | undefined, // è½¬æ¢è€Œæˆçš„çœŸå®DOM\n    key: Key | undefined // å­—ç¬¦ä¸²æˆ–è€…æ•°å­—\n}\n\nå¤åˆ¶ä»£ç \n")])])]),n("h5",{attrs:{id:"è¡¥å……"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è¡¥å……"}},[e._v("#")]),e._v(" è¡¥å……:")]),e._v(" "),n("p",[e._v("ä¸Šé¢çš„hå‡½æ•°å¤§å®¶å¯èƒ½æœ‰ç‚¹ç†Ÿæ‚‰çš„æ„Ÿè§‰ä½†æ˜¯ä¸€æ—¶é—´ä¹Ÿæ²¡æƒ³èµ·æ¥,æ²¡å…³ç³»æˆ‘æ¥å¸®å¤§ä¼™å›å¿†; "),n("code",[e._v("å¼€å‘ä¸­å¸¸è§çš„ç°å®åœºæ™¯,renderå‡½æ•°æ¸²æŸ“")]),e._v(":")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// æ¡ˆä¾‹1 vueé¡¹ç›®ä¸­çš„main.jsçš„åˆ›å»ºvueå®ä¾‹\nnew Vue({\n  router,\n  store,\n  render: h => h(App)\n}).$mount(\"#app\");\n\n//æ¡ˆä¾‹2 åˆ—è¡¨ä¸­ä½¿ç”¨renderæ¸²æŸ“\ncolumns: [\n    {\n        title: \"æ“ä½œ\",\n        key: \"action\",\n        width: 150,\n        render: (h, params) => {\n            return h('div', [\n                h('Button', {\n                    props: {\n                        size: 'small'\n                    },\n                    style: {\n                        marginRight: '5px',\n                        marginBottom: '5px',\n                    },\n                    on: {\n                        click: () => {\n                            this.toEdit(params.row.uuid);\n                        }\n                    }\n                }, 'ç¼–è¾‘')\n            ]);\n        }\n    }\n]\nå¤åˆ¶ä»£ç \n")])])]),n("hr"),e._v(" "),n("h3",{attrs:{id:"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿdom"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹Ÿdom"}},[e._v("#")]),e._v(" ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹ŸDOM")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("MVVMæ¡†æ¶è§£å†³è§†å›¾å’ŒçŠ¶æ€åŒæ­¥é—®é¢˜")])]),e._v(" "),n("li",[n("p",[e._v("æ¨¡æ¿å¼•æ“å¯ä»¥ç®€åŒ–è§†å›¾æ“ä½œ,æ²¡åŠæ³•è·Ÿè¸ªçŠ¶æ€")])]),e._v(" "),n("li",[n("p",[e._v("è™šæ‹ŸDOMè·Ÿè¸ªçŠ¶æ€å˜åŒ–")])]),e._v(" "),n("li",[n("p",[e._v("å‚è€ƒgithubä¸Š"),n("strong",[e._v("virtual-dom")]),e._v("[1]çš„åŠ¨æœºæè¿°")])]),e._v(" "),n("li",[n("ul",[n("li",[e._v("è™šæ‹ŸDOMå¯ä»¥ç»´æŠ¤ç¨‹åºçš„çŠ¶æ€,è·Ÿè¸ªä¸Šä¸€æ¬¡çš„çŠ¶æ€")]),e._v(" "),n("li",[e._v("é€šè¿‡æ¯”è¾ƒå‰åä¸¤æ¬¡çŠ¶æ€å·®å¼‚æ›´æ–°çœŸå®DOM")])])]),e._v(" "),n("li",[n("p",[e._v("è·¨å¹³å°ä½¿ç”¨")])]),e._v(" "),n("li",[n("ul",[n("li",[e._v("æµè§ˆå™¨å¹³å°æ¸²æŸ“DOM")]),e._v(" "),n("li",[e._v("æœåŠ¡ç«¯æ¸²æŸ“SSR(Nuxt.js/Next.js),å‰ç«¯æ˜¯vueå‘,åè€…æ˜¯reactå‘")]),e._v(" "),n("li",[e._v("åŸç”Ÿåº”ç”¨(Weex/React Native)")]),e._v(" "),n("li",[e._v("å°ç¨‹åº(mpvue/uni-app)ç­‰")])])]),e._v(" "),n("li",[n("p",[e._v("çœŸå®DOMçš„å±æ€§å¾ˆå¤šï¼Œåˆ›å»ºDOMèŠ‚ç‚¹å¼€é”€å¾ˆå¤§")])]),e._v(" "),n("li",[n("p",[e._v("è™šæ‹ŸDOMåªæ˜¯æ™®é€šJavaScriptå¯¹è±¡ï¼Œæè¿°å±æ€§å¹¶ä¸éœ€è¦å¾ˆå¤šï¼Œåˆ›å»ºå¼€é”€å¾ˆå°")])]),e._v(" "),n("li",[n("p",[n("strong",[e._v("å¤æ‚è§†å›¾æƒ…å†µä¸‹æå‡æ¸²æŸ“æ€§èƒ½")]),e._v("(æ“ä½œdomæ€§èƒ½æ¶ˆè€—å¤§,å‡å°‘æ“ä½œdomçš„èŒƒå›´å¯ä»¥æå‡æ€§èƒ½)")])])]),e._v(" "),n("p",[n("strong",[e._v("çµé­‚å‘é—®")]),e._v(":ä½¿ç”¨äº†è™šæ‹ŸDOMå°±ä¸€å®šä¼šæ¯”ç›´æ¥æ¸²æŸ“çœŸå®DOMå¿«å—?ç­”æ¡ˆå½“ç„¶æ˜¯"),n("code",[e._v("å¦å®š")]),e._v("çš„,ä¸”å¬æˆ‘è¯´:"),n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLOqRQpVxXrpsrQicImZicauU14gEaQsytr9ctPwnribnp8RumzfVibLJ5TA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}})]),e._v(" "),n("p",[n("strong",[e._v("ä¸¾ä¾‹")]),e._v(":å½“ä¸€ä¸ªèŠ‚ç‚¹å˜æ›´æ—¶DOMA->DOMB")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLMicqWYBn2NDILaboY0599tJPkaaOl2fJKJIScBrdjmUcGP20MxJgmRQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("ä¸Šè¿°æƒ…å†µ: "),n("code",[e._v("ç¤ºä¾‹1")]),e._v("æ˜¯åˆ›å»ºä¸€ä¸ª"),n("code",[e._v("DOMB")]),e._v("ç„¶åæ›¿æ¢æ‰"),n("code",[e._v("DOMA")]),e._v("; "),n("code",[e._v("ç¤ºä¾‹2")]),e._v("å»"),n("code",[e._v("åˆ›å»ºè™šæ‹ŸDOM+DIFFç®—æ³•")]),e._v("æ¯”å¯¹å‘ç°"),n("code",[e._v("DOMB")]),e._v("è·Ÿ"),n("code",[e._v("DOMA")]),e._v("ä¸æ˜¯ç›¸åŒçš„èŠ‚ç‚¹,æœ€åè¿˜æ˜¯åˆ›å»ºä¸€ä¸ª"),n("code",[e._v("DOMB")]),e._v("ç„¶åæ›¿æ¢æ‰"),n("code",[e._v("DOMA")]),e._v("; å¯ä»¥æ˜æ˜¾çœ‹å‡º1æ˜¯æ›´å¿«çš„,åŒæ ·çš„ç»“æœ,2è¿˜è¦å»åˆ›å»ºè™šæ‹ŸDOM+DIFFç®—å•Šå¯¹æ¯” æ‰€ä»¥è¯´ä½¿ç”¨è™šæ‹ŸDOMæ¯”ç›´æ¥æ“ä½œçœŸå®DOMå°±ä¸€å®šè¦å¿«è¿™ä¸ªè¯´æ³•æ˜¯"),n("code",[e._v("é”™è¯¯çš„,ä¸ä¸¥è°¨çš„")])]),e._v(" "),n("p",[n("strong",[e._v("ä¸¾ä¾‹")]),e._v(":å½“DOMæ ‘é‡Œé¢çš„æŸä¸ªå­èŠ‚ç‚¹çš„å†…å®¹å˜æ›´æ—¶:")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLawXVuJrQgyv2RIt2c8XXFPADLfbDMJ55ibzBib36sAbTLXv6Qgg2sySQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("å½“ä¸€äº›å¤æ‚çš„èŠ‚ç‚¹,æ¯”å¦‚è¯´ä¸€ä¸ªçˆ¶èŠ‚ç‚¹é‡Œé¢æœ‰å¤šä¸ªå­èŠ‚ç‚¹,å½“åªæ˜¯ä¸€ä¸ªå­èŠ‚ç‚¹çš„å†…å®¹å‘ç”Ÿäº†æ”¹å˜,é‚£ä¹ˆæˆ‘ä»¬æ²¡æœ‰å¿…è¦åƒ"),n("code",[e._v("ç¤ºä¾‹1")]),e._v("é‡æ–°å»æ¸²æŸ“è¿™ä¸ª"),n("code",[e._v("DOMæ ‘")]),e._v(",è¿™ä¸ªæ—¶å€™"),n("code",[e._v("è™šæ‹ŸDOM+DIFFç®—æ³•")]),e._v("å°±èƒ½å¤Ÿå¾—åˆ°å¾ˆå¥½çš„ä½“ç°,æˆ‘ä»¬é€šè¿‡"),n("code",[e._v("ç¤ºä¾‹2")]),e._v("ä½¿ç”¨"),n("code",[e._v("è™šæ‹ŸDOM+Diffç®—æ³•")]),e._v("å»æ‰¾å‡ºæ”¹å˜äº†çš„å­èŠ‚ç‚¹æ›´æ–°å®ƒçš„å†…å®¹å°±å¯ä»¥äº†")]),e._v(" "),n("p",[e._v("æ€»ç»“:"),n("strong",[e._v("å¤æ‚è§†å›¾æƒ…å†µä¸‹æå‡æ¸²æŸ“æ€§èƒ½")]),e._v(",å› ä¸º"),n("code",[e._v("è™šæ‹ŸDOM+Diffç®—æ³•")]),e._v("å¯ä»¥ç²¾å‡†æ‰¾åˆ°DOMæ ‘å˜æ›´çš„åœ°æ–¹,å‡å°‘DOMçš„æ“ä½œ(é‡æ’é‡ç»˜)")]),e._v(" "),n("hr"),e._v(" "),n("h3",{attrs:{id:"è™šæ‹Ÿdomåº“"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è™šæ‹Ÿdomåº“"}},[e._v("#")]),e._v(" è™šæ‹Ÿdomåº“")]),e._v(" "),n("ul",[n("li",[n("p",[n("strong",[e._v("Snabbdom")]),e._v("[2]")])]),e._v(" "),n("li",[n("ul",[n("li",[e._v("Vue.js2.xå†…éƒ¨ä½¿ç”¨çš„è™šæ‹ŸDOMå°±æ˜¯æ”¹é€ çš„Snabbdom")]),e._v(" "),n("li",[e._v("å¤§çº¦200SLOC(single line of code)")]),e._v(" "),n("li",[e._v("é€šè¿‡æ¨¡å—å¯æ‰©å±•")]),e._v(" "),n("li",[e._v("æºç ä½¿ç”¨TypeScriptå¼€å‘")]),e._v(" "),n("li",[e._v("æœ€å¿«çš„Virtual DOMä¹‹ä¸€")])])]),e._v(" "),n("li",[n("p",[n("strong",[e._v("virtual-dom")]),e._v("[3]")])])]),e._v(" "),n("hr"),e._v(" "),n("h2",{attrs:{id:"diffç®—æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diffç®—æ³•"}},[e._v("#")]),e._v(" Diffç®—æ³•")]),e._v(" "),n("p",[e._v("åœ¨çœ‹å®Œä¸Šè¿°çš„æ–‡ç« ä¹‹åç›¸ä¿¡å¤§å®¶å·²ç»å¯¹Diffç®—æ³•æœ‰ä¸€ä¸ªåˆæ­¥çš„æ¦‚å¿µ,æ²¡é”™,Diffç®—æ³•å…¶å®å°±æ˜¯æ‰¾å‡ºä¸¤è€…ä¹‹é—´çš„å·®å¼‚;")]),e._v(" "),n("blockquote",[n("p",[e._v("diff ç®—æ³•é¦–å…ˆè¦æ˜ç¡®ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯ Diff çš„å¯¹è±¡æ˜¯è™šæ‹ŸDOMï¼ˆvirtual domï¼‰ï¼Œæ›´æ–°çœŸå® DOM æ˜¯ Diff ç®—æ³•çš„ç»“æœã€‚")])]),e._v(" "),n("p",[e._v("ä¸‹é¢æˆ‘å°†ä¼šæ‰‹æ’•"),n("code",[e._v("snabbdom")]),e._v("æºç æ ¸å¿ƒéƒ¨åˆ†ä¸ºå¤§å®¶æ‰“å¼€"),n("code",[e._v("Diff")]),e._v("çš„å¿ƒ,ç»™ç‚¹è€å¿ƒ,åˆ«å…³ç½‘é¡µ,æˆ‘çŸ¥é“ä½ ä»¬éƒ½æ˜¯è¿™æ ·:")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLmiaaGkkBAmSsUpkaFzPL6DXA5wPrSePTiajHt6GbtZjs6gQvdRUlhwdA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("src=http___img.wxcha.com_file_201905_17_f5a4d33d48.jpg&refer=http___img.wxcha.jpeg")]),e._v(" "),n("hr"),e._v(" "),n("h2",{attrs:{id:"snabbdomçš„æ ¸å¿ƒ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#snabbdomçš„æ ¸å¿ƒ"}},[e._v("#")]),e._v(" snabbdomçš„æ ¸å¿ƒ")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("init()")]),e._v("è®¾ç½®æ¨¡å—.åˆ›å»º"),n("code",[e._v("patch()")]),e._v("å‡½æ•°")]),e._v(" "),n("li",[e._v("ä½¿ç”¨"),n("code",[e._v("h()")]),e._v("å‡½æ•°åˆ›å»ºJavaScriptå¯¹è±¡"),n("code",[e._v("(Vnode)")]),e._v("æè¿°"),n("code",[e._v("çœŸå®DOM")])]),e._v(" "),n("li",[n("code",[e._v("patch()")]),e._v("æ¯”è¾ƒ"),n("code",[e._v("æ–°æ—§ä¸¤ä¸ªVnode")])]),e._v(" "),n("li",[e._v("æŠŠå˜åŒ–çš„å†…å®¹æ›´æ–°åˆ°"),n("code",[e._v("çœŸå®DOMæ ‘")])])]),e._v(" "),n("h3",{attrs:{id:"initå‡½æ•°"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#initå‡½æ•°"}},[e._v("#")]),e._v(" initå‡½æ•°")]),e._v(" "),n("p",[e._v("initå‡½æ•°æ—¶è®¾ç½®æ¨¡å—,ç„¶ååˆ›å»ºpatch()å‡½æ•°,æˆ‘ä»¬å…ˆé€šè¿‡åœºæ™¯æ¡ˆä¾‹æ¥æœ‰ä¸€ä¸ªç›´è§‚çš„ä½“ç°:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("import {init} from 'snabbdom/build/package/init.js'\nimport {h} from 'snabbdom/build/package/h.js'\n\n// 1.å¯¼å…¥æ¨¡å—\nimport {styleModule} from \"snabbdom/build/package/modules/style\";\nimport {eventListenersModule} from \"snabbdom/build/package/modules/eventListeners\";\n\n// 2.æ³¨å†Œæ¨¡å—\nconst patch = init([\n  styleModule,\n  eventListenersModule\n])\n\n// 3.ä½¿ç”¨h()å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ¨¡å—ä¸­ä½¿ç”¨çš„æ•°æ®(å¯¹è±¡)\nlet vnode = h('div', [\n  h('h1', {style: {backgroundColor: 'red'}}, 'Hello world'),\n  h('p', {on: {click: eventHandler}}, 'Hello P')\n])\n\nfunction eventHandler() {\n  alert('ç–¼,åˆ«æ‘¸æˆ‘')\n}\n\nconst app = document.querySelector('#app')\n\npatch(app,vnode)\nå¤åˆ¶ä»£ç \n")])])]),n("p",[e._v("å½“initä½¿ç”¨äº†å¯¼å…¥çš„æ¨¡å—å°±èƒ½å¤Ÿåœ¨hå‡½æ•°ä¸­ç”¨è¿™äº›æ¨¡å—æä¾›çš„apiå»åˆ›å»º"),n("code",[e._v("è™šæ‹ŸDOM(Vnode)å¯¹è±¡")]),e._v(";åœ¨ä¸Šæ–‡ä¸­å°±ä½¿ç”¨äº†"),n("code",[e._v("æ ·å¼æ¨¡å—")]),e._v("ä»¥åŠ"),n("code",[e._v("äº‹ä»¶æ¨¡å—")]),e._v("è®©åˆ›å»ºçš„è¿™ä¸ªè™šæ‹ŸDOMå…·å¤‡æ ·å¼å±æ€§ä»¥åŠäº‹ä»¶å±æ€§,æœ€ç»ˆé€šè¿‡"),n("code",[e._v("patchå‡½æ•°")]),e._v("å¯¹æ¯”"),n("code",[e._v("ä¸¤ä¸ªè™šæ‹Ÿdom")]),e._v("(ä¼šå…ˆæŠŠappè½¬æ¢æˆè™šæ‹Ÿdom),æ›´æ–°è§†å›¾;")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLaFBls2pciaaK7XfSjuKBuTicUq5wUUmX7tF5BSPF0Hr8bruzUMSjt3Tw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("p",[e._v("æˆ‘ä»¬å†ç®€å•çœ‹çœ‹initçš„æºç éƒ¨åˆ†:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// src/package/init.ts\n/* ç¬¬ä¸€å‚æ•°å°±æ˜¯å„ä¸ªæ¨¡å—\n   ç¬¬äºŒå‚æ•°å°±æ˜¯DOMAPI,å¯ä»¥æŠŠDOMè½¬æ¢æˆåˆ«çš„å¹³å°çš„API,\nä¹Ÿå°±æ˜¯è¯´æ”¯æŒè·¨å¹³å°ä½¿ç”¨,å½“ä¸ä¼ çš„æ—¶å€™é»˜è®¤æ˜¯htmlDOMApi,è§ä¸‹æ–‡\n   initæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°,ä¸€ä¸ªå‡½æ•°è¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°,å¯ä»¥ç¼“å­˜modules,ä¸domApiä¸¤ä¸ªå‚æ•°,\né‚£ä¹ˆä»¥åç›´æ¥åªä¼ oldValueè·ŸnewValue(vnode)å°±å¯ä»¥äº†*/\nexport function init (modules: Array<Partial<Module>>, domApi?: DOMAPI) {\n\n...\n\nreturn function patch (oldVnode: VNode | Element, vnode: VNode): VNode {}\n}\nå¤åˆ¶ä»£ç \n")])])]),n("hr"),e._v(" "),n("h3",{attrs:{id:"hå‡½æ•°"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hå‡½æ•°"}},[e._v("#")]),e._v(" hå‡½æ•°")]),e._v(" "),n("p",[e._v("äº›åœ°æ–¹ä¹Ÿä¼šç”¨"),n("code",[e._v("createElement")]),e._v("æ¥å‘½å,å®ƒä»¬æ˜¯ä¸€æ ·çš„ä¸œè¥¿,éƒ½æ˜¯åˆ›å»º"),n("code",[e._v("è™šæ‹ŸDOM")]),e._v("çš„,åœ¨ä¸Šè¿°æ–‡ç« ä¸­ç›¸ä¿¡å¤§ä¼™å·²ç»å¯¹hå‡½æ•°æœ‰ä¸€ä¸ªåˆæ­¥çš„äº†è§£å¹¶ä¸”å·²ç»è”æƒ³äº†ä½¿ç”¨åœºæ™¯,å°±ä¸ä½œåœºæ™¯æ¡ˆä¾‹ä»‹ç»äº†,ç›´æ¥ä¸Šæºç éƒ¨åˆ†:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// hå‡½æ•°\nexport function h (sel: string): VNode\nexport function h (sel: string, data: VNodeData | null): VNode\nexport function h (sel: string, children: VNodeChildren): VNode\nexport function h (sel: string, data: VNodeData | null, children: VNodeChildren): VNode\nexport function h (sel: any, b?: any, c?: any): VNode {\n  var data: VNodeData = {}\n  var children: any\n  var text: any\n  var i: number\n    ...\n  return vnode(sel, data, children, text, undefined) //æœ€ç»ˆè¿”å›ä¸€ä¸ªvnodeå‡½æ•°\n};\nå¤åˆ¶ä»£ç \n// vnodeå‡½æ•°\nexport function vnode (sel: string | undefined,\n  data: any | undefined,\n  children: Array<VNode | string> | undefined,\n  text: string | undefined,\n  elm: Element | Text | undefined): VNode {\n  const key = data === undefined ? undefined : data.key\n  return { sel, data, children, text, elm, key } //æœ€ç»ˆç”ŸæˆVnodeå¯¹è±¡\n}\nå¤åˆ¶ä»£ç \n")])])]),n("p",[n("strong",[e._v("æ€»ç»“")]),e._v(":"),n("code",[e._v("hå‡½æ•°")]),e._v("å…ˆç”Ÿæˆä¸€ä¸ª"),n("code",[e._v("vnode")]),e._v("å‡½æ•°,ç„¶å"),n("code",[e._v("vnode")]),e._v("å‡½æ•°å†ç”Ÿæˆä¸€ä¸ª"),n("code",[e._v("Vnode")]),e._v("å¯¹è±¡(è™šæ‹ŸDOMå¯¹è±¡)")]),e._v(" "),n("h4",{attrs:{id:"è¡¥å……-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è¡¥å……-2"}},[e._v("#")]),e._v(" è¡¥å……:")]),e._v(" "),n("p",[e._v("åœ¨hå‡½æ•°æºç éƒ¨åˆ†æ¶‰åŠä¸€ä¸ª"),n("code",[e._v("å‡½æ•°é‡è½½")]),e._v("çš„æ¦‚å¿µ,ç®€å•è¯´æ˜ä¸€ä¸‹:")]),e._v(" "),n("ul",[n("li",[e._v("å‚æ•°ä¸ªæ•°æˆ–å‚æ•°ç±»å‹ä¸åŒçš„å‡½æ•°()")]),e._v(" "),n("li",[e._v("JavaScriptä¸­æ²¡æœ‰é‡è½½çš„æ¦‚å¿µ")]),e._v(" "),n("li",[e._v("TypeScriptä¸­æœ‰é‡è½½,ä¸è¿‡é‡è½½çš„å®ç°è¿˜æ˜¯é€šè¿‡ä»£ç è°ƒæ•´å‚æ•°")])]),e._v(" "),n("blockquote",[n("p",[e._v("é‡è½½è¿™ä¸ªæ¦‚å¿µä¸ªå‚æ•°ç›¸å…³,å’Œè¿”å›å€¼æ— å…³")])]),e._v(" "),n("ul",[n("li",[e._v("å®ä¾‹1(å‡½æ•°é‡è½½-å‚æ•°ä¸ªæ•°)")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function add(a:number,b:number){\n\nconsole.log(a+b)\n\n}\n\nfunction add(a:number,b:number,c:number){\n\nconsole.log(a+b+c)\n\n}\n\nadd(1,2)\n\nadd(1,2,3)\n\nå¤åˆ¶ä»£ç \n")])])]),n("ul",[n("li",[e._v("å®ä¾‹2(å‡½æ•°é‡è½½-å‚æ•°ç±»å‹)")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function add(a:number,b:number){\n\nconsole.log(a+b)\n\n}\n\nfunction add(a:number,b:string){\n\nconsole.log(a+b)\n\n}\n\nadd(1,2)\n\nadd(1,'2')\n\nå¤åˆ¶ä»£ç \n")])])]),n("hr"),e._v(" "),n("h3",{attrs:{id:"patchå‡½æ•°-æ ¸å¿ƒ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#patchå‡½æ•°-æ ¸å¿ƒ"}},[e._v("#")]),e._v(" patchå‡½æ•°(æ ¸å¿ƒ)")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLdMiaEDJ8ZsO8A93InplfPM97XWqSnm6Y3nLH4QwOdVyqrwpVvJP5VJg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("src=http___shp.qpic.cn_qqvideo_ori_0_e3012t7v643_496_280_0&refer=http___shp.qpic.jpeg")]),e._v(" "),n("p",[e._v("è¦æ˜¯çœ‹å®Œå‰é¢çš„é“ºå«,çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½èµ°ç¥äº†,"),n("code",[e._v("é†’é†’å•Š,è¿™æ˜¯æ ¸å¿ƒå•Š,ä¸Šé«˜åœ°äº†å…„å¼Ÿ")]),e._v(";")]),e._v(" "),n("ul",[n("li",[e._v("pactch(oldVnode,newVnode)")]),e._v(" "),n("li",[e._v("æŠŠæ–°èŠ‚ç‚¹ä¸­å˜åŒ–çš„å†…å®¹æ¸²æŸ“åˆ°çœŸå®DOM,æœ€åè¿”å›æ–°èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€æ¬¡å¤„ç†çš„æ—§èŠ‚ç‚¹(æ ¸å¿ƒ)")]),e._v(" "),n("li",[e._v("å¯¹æ¯”æ–°æ—§"),n("code",[e._v("VNode")]),e._v("æ˜¯å¦ç›¸åŒèŠ‚ç‚¹(èŠ‚ç‚¹çš„keyå’Œselç›¸åŒ)")]),e._v(" "),n("li",[e._v("å¦‚æœä¸æ˜¯ç›¸åŒèŠ‚ç‚¹,åˆ é™¤ä¹‹å‰çš„å†…å®¹,é‡æ–°æ¸²æŸ“")]),e._v(" "),n("li",[e._v("å¦‚æœæ˜¯ç›¸åŒèŠ‚ç‚¹,å†åˆ¤æ–­æ–°çš„"),n("code",[e._v("VNode")]),e._v("æ˜¯å¦æœ‰"),n("code",[e._v("text")]),e._v(",å¦‚æœæœ‰å¹¶ä¸”å’Œ"),n("code",[e._v("oldVnode")]),e._v("çš„"),n("code",[e._v("text")]),e._v("ä¸åŒç›´æ¥æ›´æ–°æ–‡æœ¬å†…å®¹"),n("code",[e._v("(patchVnode)")])]),e._v(" "),n("li",[e._v("å¦‚æœæ–°çš„VNodeæœ‰children,åˆ¤æ–­å­èŠ‚ç‚¹æ˜¯å¦æœ‰å˜åŒ–"),n("code",[e._v("(updateChildren,æœ€éº»çƒ¦,æœ€éš¾å®ç°)")])])]),e._v(" "),n("p",[e._v("æºç :")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("return function patch(oldVnode: VNode | Element, vnode: VNode): VNode {    \n    let i: number, elm: Node, parent: Node\n    const insertedVnodeQueue: VNodeQueue = []\n    // cbs.preå°±æ˜¯æ‰€æœ‰æ¨¡å—çš„preé’©å­å‡½æ•°é›†åˆ\n    for (i = 0; i < cbs.pre.length; ++i) cbs.pre[i]()\n    // isVnodeå‡½æ•°æ—¶åˆ¤æ–­oldVnodeæ˜¯å¦æ˜¯ä¸€ä¸ªè™šæ‹ŸDOMå¯¹è±¡\n    if (!isVnode(oldVnode)) {\n        // è‹¥ä¸æ˜¯å³æŠŠElementè½¬æ¢æˆä¸€ä¸ªè™šæ‹ŸDOMå¯¹è±¡\n        oldVnode = emptyNodeAt(oldVnode)\n    }\n    // sameVnodeå‡½æ•°ç”¨äºåˆ¤æ–­ä¸¤ä¸ªè™šæ‹ŸDOMæ˜¯å¦æ˜¯ç›¸åŒçš„,æºç è§è¡¥å……1;\n    if (sameVnode(oldVnode, vnode)) {\n        // ç›¸åŒåˆ™è¿è¡ŒpatchVnodeå¯¹æ¯”ä¸¤ä¸ªèŠ‚ç‚¹,å…³äºpatchVnodeåé¢ä¼šé‡ç‚¹è¯´æ˜(æ ¸å¿ƒ)\n        patchVnode(oldVnode, vnode, insertedVnodeQueue)\n    } else {\n        elm = oldVnode.elm! // !æ˜¯tsçš„ä¸€ç§å†™æ³•ä»£ç oldVnode.elmè‚¯å®šæœ‰å€¼\n        // parentNodeå°±æ˜¯è·å–çˆ¶å…ƒç´ \n        parent = api.parentNode(elm) as Node\n\n        // createElmæ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªdomå…ƒç´ æ’å…¥åˆ°vnodeä¸­(æ–°çš„è™šæ‹ŸDOM)\n        createElm(vnode, insertedVnodeQueue)\n\n        if (parent !== null) {\n            // æŠŠdomå…ƒç´ æ’å…¥åˆ°çˆ¶å…ƒç´ ä¸­,å¹¶ä¸”æŠŠæ—§çš„domåˆ é™¤\n            api.insertBefore(parent, vnode.elm!, api.nextSibling(elm))// æŠŠæ–°åˆ›å»ºçš„å…ƒç´ æ”¾åœ¨æ—§çš„domåé¢\n            removeVnodes(parent, [oldVnode], 0, 0)\n        }\n    }\n\n    for (i = 0; i < insertedVnodeQueue.length; ++i) {\n        insertedVnodeQueue[i].data!.hook!.insert!(insertedVnodeQueue[i])\n    }\n    for (i = 0; i < cbs.post.length; ++i) cbs.post[i]()\n    return vnode\n}\nå¤åˆ¶ä»£ç \n")])])]),n("h4",{attrs:{id:"è¡¥å……1-samevnodeå‡½æ•°"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è¡¥å……1-samevnodeå‡½æ•°"}},[e._v("#")]),e._v(" è¡¥å……1: sameVnodeå‡½æ•°")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function sameVnode(vnode1: VNode, vnode2: VNode): boolean { é€šè¿‡keyå’Œselé€‰æ‹©å™¨åˆ¤æ–­æ˜¯å¦æ˜¯ç›¸åŒèŠ‚ç‚¹\n    return vnode1.key === vnode2.key && vnode1.sel === vnode2.sel\n}\nå¤åˆ¶ä»£ç \n")])])]),n("hr"),e._v(" "),n("h3",{attrs:{id:"patchvnode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#patchvnode"}},[e._v("#")]),e._v(" patchVnode")]),e._v(" "),n("ul",[n("li",[e._v("ç¬¬ä¸€é˜¶æ®µè§¦å‘"),n("code",[e._v("prepatch")]),e._v("å‡½æ•°ä»¥åŠ"),n("code",[e._v("update")]),e._v("å‡½æ•°(éƒ½ä¼šè§¦å‘prepatchå‡½æ•°,ä¸¤è€…ä¸å®Œå…¨ç›¸åŒæ‰ä¼šè§¦å‘updateå‡½æ•°)")]),e._v(" "),n("li",[e._v("ç¬¬äºŒé˜¶æ®µ,çœŸæ­£å¯¹æ¯”æ–°æ—§"),n("code",[e._v("vnode")]),e._v("å·®å¼‚çš„åœ°æ–¹")]),e._v(" "),n("li",[e._v("ç¬¬ä¸‰é˜¶æ®µ,è§¦å‘"),n("code",[e._v("postpatch")]),e._v("å‡½æ•°æ›´æ–°èŠ‚ç‚¹")])]),e._v(" "),n("p",[e._v("æºç :")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function patchVnode(oldVnode: VNode, vnode: VNode, insertedVnodeQueue: VNodeQueue) {\n    const hook = vnode.data?.hook\n    hook?.prepatch?.(oldVnode, vnode)\n    const elm = vnode.elm = oldVnode.elm!\n    const oldCh = oldVnode.children as VNode[]\n    const ch = vnode.children as VNode[]\n    if (oldVnode === vnode) return\n    if (vnode.data !== undefined) {\n        for (let i = 0; i < cbs.update.length; ++i) cbs.update[i](oldVnode, vnode)\n        vnode.data.hook?.update?.(oldVnode, vnode)\n    }\n    if (isUndef(vnode.text)) { // æ–°èŠ‚ç‚¹çš„textå±æ€§æ˜¯undefined\n        if (isDef(oldCh) && isDef(ch)) { // å½“æ–°æ—§èŠ‚ç‚¹éƒ½å­˜åœ¨å­èŠ‚ç‚¹\n            if (oldCh !== ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue) //å¹¶ä¸”ä»–ä»¬çš„å­èŠ‚ç‚¹ä¸ç›¸åŒæ‰§è¡ŒupdateChildrenå‡½æ•°,åç»­ä¼šé‡ç‚¹è¯´æ˜(æ ¸å¿ƒ)\n        } else if (isDef(ch)) { // åªæœ‰æ–°èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹\n            // å½“æ—§èŠ‚ç‚¹æœ‰textå±æ€§å°±ä¼šæŠŠ''èµ‹äºˆç»™çœŸå®domçš„textå±æ€§\n            if (isDef(oldVnode.text)) api.setTextContent(elm, '') \n            // å¹¶ä¸”æŠŠæ–°èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹æ’å…¥åˆ°çœŸå®domä¸­\n            addVnodes(elm, null, ch, 0, ch.length - 1, insertedVnodeQueue)\n        } else if (isDef(oldCh)) { // æ¸…é™¤çœŸå®domçš„æ‰€æœ‰å­èŠ‚ç‚¹\n            removeVnodes(elm, oldCh, 0, oldCh.length - 1)\n        } else if (isDef(oldVnode.text)) { // æŠŠ''èµ‹äºˆç»™çœŸå®domçš„textå±æ€§\n            api.setTextContent(elm, '')\n        }\n    } else if (oldVnode.text !== vnode.text) { //è‹¥æ—§èŠ‚ç‚¹çš„textä¸æ–°èŠ‚ç‚¹çš„textä¸ç›¸åŒ\n        if (isDef(oldCh)) { // è‹¥æ—§èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹,å°±æŠŠæ‰€æœ‰çš„å­èŠ‚ç‚¹åˆ é™¤\n            removeVnodes(elm, oldCh, 0, oldCh.length - 1)\n        }\n        api.setTextContent(elm, vnode.text!) // æŠŠæ–°èŠ‚ç‚¹çš„textèµ‹äºˆç»™çœŸå®dom\n    }\n    hook?.postpatch?.(oldVnode, vnode) // æ›´æ–°è§†å›¾\n}\nå¤åˆ¶ä»£ç \n")])])]),n("p",[e._v("çœ‹å¾—å¯èƒ½æœ‰ç‚¹è’™è”½,ä¸‹é¢å†ä¸Šä¸€å‰¯æ€ç»´å¯¼å›¾:")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLHNVic3kCtibTYFxoJKuJxNsibX6CrbylKsKXUUoWAwAXfyxSCapNOJJUw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("hr"),e._v(" "),n("h3",{attrs:{id:"é¢˜å¤–è¯-diffç®—æ³•ç®€ä»‹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#é¢˜å¤–è¯-diffç®—æ³•ç®€ä»‹"}},[e._v("#")]),e._v(" é¢˜å¤–è¯:diffç®—æ³•ç®€ä»‹")]),e._v(" "),n("p",[n("strong",[e._v("ä¼ ç»Ÿdiffç®—æ³•")])]),e._v(" "),n("ul",[n("li",[e._v("è™šæ‹ŸDOMä¸­çš„Diffç®—æ³•")]),e._v(" "),n("li",[n("code",[e._v("ä¼ ç»Ÿç®—æ³•")]),e._v("æŸ¥æ‰¾ä¸¤é¢—æ ‘æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å·®å¼‚")]),e._v(" "),n("li",[e._v("ä¼šè¿è¡Œn1(dom1çš„èŠ‚ç‚¹æ•°)*n2(dom2çš„èŠ‚ç‚¹æ•°)æ¬¡æ–¹å»å¯¹æ¯”,æ‰¾åˆ°å·®å¼‚çš„éƒ¨åˆ†å†å»æ›´æ–°")])]),e._v(" "),n("p",[n("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("p",[n("strong",[e._v("snabbdomçš„diffç®—æ³•ä¼˜åŒ–")])]),e._v(" "),n("ul",[n("li",[e._v("Snbbdomæ ¹æ®DOMçš„ç‰¹ç‚¹å¯¹ä¼ ç»Ÿçš„diffç®—æ³•åšäº†"),n("code",[e._v("ä¼˜åŒ–")])]),e._v(" "),n("li",[e._v("DOMæ“ä½œæ—¶å€™å¾ˆå°‘ä¼šè·¨çº§åˆ«æ“ä½œèŠ‚ç‚¹")]),e._v(" "),n("li",[e._v("åªæ¯”è¾ƒ"),n("code",[e._v("åŒçº§åˆ«")]),e._v("çš„èŠ‚ç‚¹")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLhTt5D51vDv7tKQJxPMIoJBiaZVnGVEyulmeDO6XoaOgg0wcAcfib0huw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLPiclzDgbxv9NeLzmfvHlj8c4nG4GyIC5ibnxSxj9iaAIibvQy6ic8kDcUdw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("src=http___img.wxcha.com_file_202004_03_1ed2e19e4f.jpg&refer=http___img.wxcha.jpeg")]),e._v(" "),n("p",[e._v("ä¸‹é¢æˆ‘ä»¬å°±ä¼šä»‹ç»"),n("code",[e._v("updateChildren")]),e._v("å‡½æ•°æ€ä¹ˆå»å¯¹æ¯”å­èŠ‚ç‚¹çš„"),n("code",[e._v("å¼‚åŒ")]),e._v(",ä¹Ÿæ˜¯"),n("code",[e._v("Diffç®—æ³•")]),e._v("é‡Œé¢çš„ä¸€ä¸ªæ ¸å¿ƒä»¥åŠéš¾ç‚¹;")]),e._v(" "),n("hr"),e._v(" "),n("h3",{attrs:{id:"updatechildren-æ ¸ä¸­æ ¸-åˆ¤æ–­å­èŠ‚ç‚¹çš„å·®å¼‚"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#updatechildren-æ ¸ä¸­æ ¸-åˆ¤æ–­å­èŠ‚ç‚¹çš„å·®å¼‚"}},[e._v("#")]),e._v(" updateChildren(æ ¸ä¸­æ ¸:åˆ¤æ–­å­èŠ‚ç‚¹çš„å·®å¼‚)")]),e._v(" "),n("ul",[n("li",[e._v("è¿™ä¸ªå‡½æ•°æˆ‘åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†,"),n("code",[e._v("éƒ¨åˆ†1:å£°æ˜å˜é‡")]),e._v(","),n("code",[e._v("éƒ¨åˆ†2:åŒçº§åˆ«èŠ‚ç‚¹æ¯”è¾ƒ")]),e._v(","),n("code",[e._v("éƒ¨åˆ†3:å¾ªç¯ç»“æŸçš„æ”¶å°¾å·¥ä½œ")]),e._v("(è§ä¸‹å›¾);")])]),e._v(" "),n("p",[n("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("åŒçº§åˆ«èŠ‚ç‚¹æ¯”è¾ƒ")]),e._v("çš„"),n("code",[e._v("äº”ç§")]),e._v("æƒ…å†µ:")])]),e._v(" "),n("li",[n("ol",[n("li",[n("code",[e._v("oldStartVnode/newStartVnode")]),e._v("(æ—§å¼€å§‹èŠ‚ç‚¹/æ–°å¼€å§‹èŠ‚ç‚¹)ç›¸åŒ")]),e._v(" "),n("li",[n("code",[e._v("oldEndVnode/newEndVnode")]),e._v("(æ—§ç»“æŸèŠ‚ç‚¹/æ–°ç»“æŸèŠ‚ç‚¹)ç›¸åŒ")]),e._v(" "),n("li",[n("code",[e._v("oldStartVnode/newEndVnode")]),e._v("(æ—§å¼€å§‹èŠ‚ç‚¹/æ–°ç»“æŸèŠ‚ç‚¹)ç›¸åŒ")]),e._v(" "),n("li",[n("code",[e._v("oldEndVnode/newStartVnode")]),e._v("(æ—§ç»“æŸèŠ‚ç‚¹/æ–°å¼€å§‹èŠ‚ç‚¹)ç›¸åŒ")]),e._v(" "),n("li",[n("code",[e._v("ç‰¹æ®Šæƒ…å†µå½“1,2,3,4çš„æƒ…å†µéƒ½ä¸ç¬¦åˆ")]),e._v("çš„æ—¶å€™å°±ä¼šæ‰§è¡Œ,åœ¨"),n("code",[e._v("oldVnodes")]),e._v("é‡Œé¢å¯»æ‰¾è·Ÿ"),n("code",[e._v("newStartVnode")]),e._v("ä¸€æ ·çš„èŠ‚ç‚¹ç„¶åä½ç§»åˆ°"),n("code",[e._v("oldStartVnode")]),e._v(",è‹¥æ²¡æœ‰æ‰¾åˆ°åœ¨å°±"),n("code",[e._v("oldStartVnode")]),e._v("åˆ›å»ºä¸€ä¸ª")])])]),e._v(" "),n("li",[n("p",[e._v("æ‰§è¡Œè¿‡ç¨‹æ˜¯ä¸€ä¸ªå¾ªç¯,åœ¨æ¯æ¬¡å¾ªç¯é‡Œ,åªè¦æ‰§è¡Œäº†ä¸Šè¿°çš„æƒ…å†µçš„äº”ç§ä¹‹ä¸€å°±ä¼šç»“æŸä¸€æ¬¡å¾ªç¯")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("å¾ªç¯ç»“æŸçš„æ”¶å°¾å·¥ä½œ")]),e._v(":ç›´åˆ°oldStartIdx>oldEndIdx || newStartIdx>newEndIdx(ä»£è¡¨æ—§èŠ‚ç‚¹æˆ–è€…æ–°èŠ‚ç‚¹å·²ç»éå†å®Œ)")])])]),e._v(" "),n("p",[e._v("ä¸ºäº†æ›´åŠ ç›´è§‚çš„äº†è§£,æˆ‘ä»¬å†æ¥çœ‹çœ‹"),n("code",[e._v("åŒçº§åˆ«èŠ‚ç‚¹æ¯”è¾ƒ")]),e._v("çš„"),n("code",[e._v("äº”ç§")]),e._v("æƒ…å†µçš„å®ç°ç»†èŠ‚:")]),e._v(" "),n("h4",{attrs:{id:"æ–°å¼€å§‹èŠ‚ç‚¹å’Œæ—§å¼€å§‹èŠ‚ç‚¹-æƒ…å†µ1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ–°å¼€å§‹èŠ‚ç‚¹å’Œæ—§å¼€å§‹èŠ‚ç‚¹-æƒ…å†µ1"}},[e._v("#")]),e._v(" æ–°å¼€å§‹èŠ‚ç‚¹å’Œæ—§å¼€å§‹èŠ‚ç‚¹(æƒ…å†µ1)")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGL0FukiaVosSclGTu0CVmzFnDl25vU2xDfGFqrdib1ApyMxbicfJHU7hxoQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[e._v("è‹¥"),n("code",[e._v("æƒ…å†µ1ç¬¦åˆ:(ä»æ–°æ—§èŠ‚ç‚¹çš„å¼€å§‹èŠ‚ç‚¹å¼€å§‹å¯¹æ¯”")]),e._v(","),n("code",[e._v("oldCh[oldStartIdx]å’ŒnewCh[newStartIdx]")]),e._v("è¿›è¡Œ"),n("code",[e._v("sameVnode(keyå’Œselç›¸åŒ)")]),e._v("åˆ¤æ–­æ˜¯å¦ç›¸åŒèŠ‚ç‚¹)")]),e._v(" "),n("li",[e._v("åˆ™æ‰§è¡Œ"),n("code",[e._v("patchVnode")]),e._v("æ‰¾å‡ºä¸¤è€…ä¹‹é—´çš„å·®å¼‚,æ›´æ–°å›¾;å¦‚æ²¡æœ‰å·®å¼‚åˆ™ä»€ä¹ˆéƒ½ä¸æ“ä½œ,ç»“æŸä¸€æ¬¡å¾ªç¯")]),e._v(" "),n("li",[n("code",[e._v("oldStartIdx++/newStartIdx++")])])]),e._v(" "),n("h4",{attrs:{id:"æ–°ç»“æŸèŠ‚ç‚¹å’Œæ—§ç»“æŸèŠ‚ç‚¹-æƒ…å†µ2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ–°ç»“æŸèŠ‚ç‚¹å’Œæ—§ç»“æŸèŠ‚ç‚¹-æƒ…å†µ2"}},[e._v("#")]),e._v(" æ–°ç»“æŸèŠ‚ç‚¹å’Œæ—§ç»“æŸèŠ‚ç‚¹(æƒ…å†µ2)")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLVLrlUWMxPpwEeGcyyqNlav4kQ39b67C6udVcSBVQMUCbJ2cQuy2Mrw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[e._v("è‹¥"),n("code",[e._v("æƒ…å†µ1ä¸ç¬¦åˆ")]),e._v("å°±åˆ¤æ–­"),n("code",[e._v("æƒ…å†µ2")]),e._v(",è‹¥ç¬¦åˆ:(ä»æ–°æ—§èŠ‚ç‚¹çš„ç»“æŸèŠ‚ç‚¹å¼€å§‹å¯¹æ¯”,"),n("code",[e._v("oldCh[oldEndIdx]å’ŒnewCh[newEndIdx]")]),e._v("å¯¹æ¯”,æ‰§è¡Œ"),n("code",[e._v("sameVnode(keyå’Œselç›¸åŒ)")]),e._v("åˆ¤æ–­æ˜¯å¦ç›¸åŒèŠ‚ç‚¹)")]),e._v(" "),n("li",[e._v("æ‰§è¡Œ"),n("code",[e._v("patchVnode")]),e._v("æ‰¾å‡ºä¸¤è€…ä¹‹é—´çš„å·®å¼‚,æ›´æ–°è§†å›¾,;å¦‚æ²¡æœ‰å·®å¼‚åˆ™ä»€ä¹ˆéƒ½ä¸æ“ä½œ,ç»“æŸä¸€æ¬¡å¾ªç¯")]),e._v(" "),n("li",[n("code",[e._v("oldEndIdx--/newEndIdx--")])])]),e._v(" "),n("h4",{attrs:{id:"æ—§å¼€å§‹èŠ‚ç‚¹-æ–°ç»“æŸèŠ‚ç‚¹-æƒ…å†µ3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ—§å¼€å§‹èŠ‚ç‚¹-æ–°ç»“æŸèŠ‚ç‚¹-æƒ…å†µ3"}},[e._v("#")]),e._v(" æ—§å¼€å§‹èŠ‚ç‚¹/æ–°ç»“æŸèŠ‚ç‚¹(æƒ…å†µ3)")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLZVArY457qurQ68lYhlOoMwPsP0MH6vwhmCCqbkFA9UticROnNkicLHMw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[e._v("è‹¥"),n("code",[e._v("æƒ…å†µ1,2")]),e._v("éƒ½ä¸ç¬¦åˆ,å°±ä¼šå°è¯•æƒ…å†µ3:(æ—§èŠ‚ç‚¹çš„å¼€å§‹èŠ‚ç‚¹ä¸æ–°èŠ‚ç‚¹çš„ç»“æŸèŠ‚ç‚¹å¼€å§‹å¯¹æ¯”,"),n("code",[e._v("oldCh[oldStartIdx]å’ŒnewCh[newEndIdx]")]),e._v("å¯¹æ¯”,æ‰§è¡Œ"),n("code",[e._v("sameVnode(keyå’Œselç›¸åŒ)")]),e._v("åˆ¤æ–­æ˜¯å¦ç›¸åŒèŠ‚ç‚¹)")]),e._v(" "),n("li",[e._v("æ‰§è¡Œ"),n("code",[e._v("patchVnode")]),e._v("æ‰¾å‡ºä¸¤è€…ä¹‹é—´çš„å·®å¼‚,æ›´æ–°è§†å›¾,å¦‚æ²¡æœ‰å·®å¼‚åˆ™ä»€ä¹ˆéƒ½ä¸æ“ä½œ,ç»“æŸä¸€æ¬¡å¾ªç¯")]),e._v(" "),n("li",[n("code",[e._v("oldCh[oldStartIdx]å¯¹åº”çš„çœŸå®dom")]),e._v("ä½ç§»åˆ°"),n("code",[e._v("oldCh[oldEndIdx]å¯¹åº”çš„çœŸå®dom")]),e._v("å")]),e._v(" "),n("li",[n("code",[e._v("oldStartIdx++/newEndIdx--")]),e._v(";")])]),e._v(" "),n("h4",{attrs:{id:"æ—§ç»“æŸèŠ‚ç‚¹-æ–°å¼€å§‹èŠ‚ç‚¹-æƒ…å†µ4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ—§ç»“æŸèŠ‚ç‚¹-æ–°å¼€å§‹èŠ‚ç‚¹-æƒ…å†µ4"}},[e._v("#")]),e._v(" æ—§ç»“æŸèŠ‚ç‚¹/æ–°å¼€å§‹èŠ‚ç‚¹(æƒ…å†µ4)")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLrSn8AFYYhe5PkXz3mvF8vmlgMIVWMib7ia6M8RPLiaF0icOjecqDARRQrw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[e._v("è‹¥"),n("code",[e._v("æƒ…å†µ1,2,3")]),e._v("éƒ½ä¸ç¬¦åˆ,å°±ä¼šå°è¯•æƒ…å†µ4:(æ—§èŠ‚ç‚¹çš„ç»“æŸèŠ‚ç‚¹ä¸æ–°èŠ‚ç‚¹çš„å¼€å§‹èŠ‚ç‚¹å¼€å§‹å¯¹æ¯”,"),n("code",[e._v("oldCh[oldEndIdx]å’ŒnewCh[newStartIdx]")]),e._v("å¯¹æ¯”,æ‰§è¡Œ"),n("code",[e._v("sameVnode(keyå’Œselç›¸åŒ)")]),e._v("åˆ¤æ–­æ˜¯å¦ç›¸åŒèŠ‚ç‚¹)")]),e._v(" "),n("li",[e._v("æ‰§è¡Œ"),n("code",[e._v("patchVnode")]),e._v("æ‰¾å‡ºä¸¤è€…ä¹‹é—´çš„å·®å¼‚,æ›´æ–°è§†å›¾,å¦‚æ²¡æœ‰å·®å¼‚åˆ™ä»€ä¹ˆéƒ½ä¸æ“ä½œ,ç»“æŸä¸€æ¬¡å¾ªç¯")]),e._v(" "),n("li",[n("code",[e._v("oldCh[oldEndIdx]å¯¹åº”çš„çœŸå®dom")]),e._v("ä½ç§»åˆ°"),n("code",[e._v("oldCh[oldStartIdx]å¯¹åº”çš„çœŸå®dom")]),e._v("å‰")]),e._v(" "),n("li",[n("code",[e._v("oldEndIdx--/newStartIdx++")]),e._v(";")])]),e._v(" "),n("h4",{attrs:{id:"æ–°å¼€å§‹èŠ‚ç‚¹-æ—§èŠ‚ç‚¹æ•°ç»„ä¸­å¯»æ‰¾èŠ‚ç‚¹-æƒ…å†µ5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ–°å¼€å§‹èŠ‚ç‚¹-æ—§èŠ‚ç‚¹æ•°ç»„ä¸­å¯»æ‰¾èŠ‚ç‚¹-æƒ…å†µ5"}},[e._v("#")]),e._v(" æ–°å¼€å§‹èŠ‚ç‚¹/æ—§èŠ‚ç‚¹æ•°ç»„ä¸­å¯»æ‰¾èŠ‚ç‚¹(æƒ…å†µ5)")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLDfkGugZlWV20ibb28fccQYyfnVQrKRkbI0OhQk7YWMfzGa2lhRZiatYQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[e._v("ä»æ—§èŠ‚ç‚¹é‡Œé¢å¯»æ‰¾,è‹¥å¯»æ‰¾åˆ°ä¸"),n("code",[e._v("newCh[newStartIdx]")]),e._v("ç›¸åŒçš„èŠ‚ç‚¹(ä¸”å«"),n("code",[e._v("å¯¹åº”èŠ‚ç‚¹[1]")]),e._v("),æ‰§è¡Œ"),n("code",[e._v("patchVnode")]),e._v("æ‰¾å‡ºä¸¤è€…ä¹‹é—´çš„å·®å¼‚,æ›´æ–°è§†å›¾,å¦‚æ²¡æœ‰å·®å¼‚åˆ™ä»€ä¹ˆéƒ½ä¸æ“ä½œ,ç»“æŸä¸€æ¬¡å¾ªç¯")]),e._v(" "),n("li",[n("code",[e._v("å¯¹åº”èŠ‚ç‚¹[1]å¯¹åº”çš„çœŸå®dom")]),e._v("ä½ç§»åˆ°"),n("code",[e._v("oldCh[oldStartIdx]å¯¹åº”çš„çœŸå®dom")]),e._v("å‰")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLH3WaEve0S2DSdgSNRG7ZD6wEvRbGkXZzGx1MkprolMTtTzbW9UdeSg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("è‹¥æ²¡æœ‰å¯»æ‰¾åˆ°ç›¸åŒçš„èŠ‚ç‚¹")]),e._v(",åˆ™åˆ›å»ºä¸€ä¸ªä¸"),n("code",[e._v("newCh[newStartIdx]")]),e._v("èŠ‚ç‚¹å¯¹åº”çš„"),n("code",[e._v("çœŸå®dom")]),e._v("æ’å…¥åˆ°"),n("code",[e._v("oldCh[oldStartIdx]å¯¹åº”çš„çœŸå®dom")]),e._v("å‰")]),e._v(" "),n("li",[n("code",[e._v("newStartIdx++")])])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_jpg/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLzpq1l65ibHAOJ2cmVFjzribYZmcS4tEFAO9Y7vLvum5w6PtZic5Fve3Fw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("379426071b8130075b11ba142f9468e2.jpeg")]),e._v(" "),n("hr"),e._v(" "),n("p",[e._v("ä¸‹é¢æˆ‘ä»¬å†ä»‹ç»ä¸€ä¸‹"),n("code",[e._v("ç»“æŸå¾ªç¯")]),e._v("çš„æ”¶å°¾å·¥ä½œ"),n("code",[e._v("(oldStartIdx>oldEndIdx || newStartIdx>newEndIdx)")]),e._v(":")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLmYk2PhgcCYDS65VF1IO40oePD81kk9mnXtEGzmFRSz6twwVHPNRYYQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("æ–°èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹")]),e._v("å…ˆéå†å®Œ("),n("code",[e._v("newStartIdx>newEndIdx")]),e._v("),å¾ªç¯ç»“æŸ")]),e._v(" "),n("li",[n("code",[e._v("æ–°èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹")]),e._v("éå†ç»“æŸå°±æ˜¯æŠŠæ²¡æœ‰å¯¹åº”ç›¸åŒèŠ‚ç‚¹çš„"),n("code",[e._v("å­èŠ‚ç‚¹")]),e._v("åˆ é™¤")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLxpzF89kARG0zoXdXQXupc0PXWK4SyBSUib2vyLlemRV1zNHiaYRXpoDA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("æ—§èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹")]),e._v("å…ˆéå†å®Œ("),n("code",[e._v("oldStartIdx>oldEndIdx")]),e._v("),å¾ªç¯ç»“æŸ")]),e._v(" "),n("li",[n("code",[e._v("æ—§èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹")]),e._v("éå†ç»“æŸå°±æ˜¯åœ¨å¤šå‡ºæ¥çš„"),n("code",[e._v("å­èŠ‚ç‚¹")]),e._v("æ’å…¥åˆ°"),n("code",[e._v("æ—§èŠ‚ç‚¹ç»“æŸèŠ‚ç‚¹")]),e._v("å‰;(æºç :"),n("code",[e._v("newCh[newEndIdx + 1].elm)")]),e._v(",å°±æ˜¯å¯¹åº”çš„"),n("code",[e._v("æ—§ç»“æŸèŠ‚ç‚¹çš„çœŸå®dom")]),e._v(",newEndIdx+1æ˜¯å› ä¸ºåœ¨åŒ¹é…åˆ°ç›¸åŒçš„èŠ‚ç‚¹éœ€è¦-1,æ‰€ä»¥éœ€è¦åŠ å›æ¥å°±æ˜¯ç»“æŸèŠ‚ç‚¹")])]),e._v(" "),n("p",[e._v("æœ€åé™„ä¸Šæºç :")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function updateChildren(parentElm, oldCh, newCh, insertedVnodeQueue) {\n    let oldStartIdx = 0;                // æ—§èŠ‚ç‚¹å¼€å§‹èŠ‚ç‚¹ç´¢å¼•\n    let newStartIdx = 0;                // æ–°èŠ‚ç‚¹å¼€å§‹èŠ‚ç‚¹ç´¢å¼•\n    let oldEndIdx = oldCh.length - 1;   // æ—§èŠ‚ç‚¹ç»“æŸèŠ‚ç‚¹ç´¢å¼•\n    let oldStartVnode = oldCh[0];       // æ—§èŠ‚ç‚¹å¼€å§‹èŠ‚ç‚¹\n    let oldEndVnode = oldCh[oldEndIdx]; // æ—§èŠ‚ç‚¹ç»“æŸèŠ‚ç‚¹\n    let newEndIdx = newCh.length - 1;   // æ–°èŠ‚ç‚¹ç»“æŸèŠ‚ç‚¹ç´¢å¼•\n    let newStartVnode = newCh[0];       // æ–°èŠ‚ç‚¹å¼€å§‹èŠ‚ç‚¹\n    let newEndVnode = newCh[newEndIdx]; // æ–°èŠ‚ç‚¹ç»“æŸèŠ‚ç‚¹\n    let oldKeyToIdx;                    // èŠ‚ç‚¹ç§»åŠ¨ç›¸å…³\n    let idxInOld;                       // èŠ‚ç‚¹ç§»åŠ¨ç›¸å…³\n    let elmToMove;                      // èŠ‚ç‚¹ç§»åŠ¨ç›¸å…³\n    let before;\n\n\n    // åŒçº§åˆ«èŠ‚ç‚¹æ¯”è¾ƒ\n    while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {\n        if (oldStartVnode == null) {\n            oldStartVnode = oldCh[++oldStartIdx]; // Vnode might have been moved left\n        }\n        else if (oldEndVnode == null) {\n            oldEndVnode = oldCh[--oldEndIdx];\n        }\n        else if (newStartVnode == null) {\n            newStartVnode = newCh[++newStartIdx];\n        }\n        else if (newEndVnode == null) {\n            newEndVnode = newCh[--newEndIdx];\n        }\n        else if (sameVnode(oldStartVnode, newStartVnode)) { // åˆ¤æ–­æƒ…å†µ1\n            patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue);\n            oldStartVnode = oldCh[++oldStartIdx];\n            newStartVnode = newCh[++newStartIdx];\n        }\n        else if (sameVnode(oldEndVnode, newEndVnode)) {   // æƒ…å†µ2\n            patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue);\n            oldEndVnode = oldCh[--oldEndIdx];\n            newEndVnode = newCh[--newEndIdx];\n        }\n        else if (sameVnode(oldStartVnode, newEndVnode)) { // Vnode moved rightæƒ…å†µ3\n            patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue);\n            api.insertBefore(parentElm, oldStartVnode.elm, api.nextSibling(oldEndVnode.elm));\n            oldStartVnode = oldCh[++oldStartIdx];\n            newEndVnode = newCh[--newEndIdx];\n        }\n        else if (sameVnode(oldEndVnode, newStartVnode)) { // Vnode moved leftæƒ…å†µ4\n            patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue);\n            api.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm);\n            oldEndVnode = oldCh[--oldEndIdx];\n            newStartVnode = newCh[++newStartIdx];\n        }\n        else {                                             // æƒ…å†µ5\n            if (oldKeyToIdx === undefined) {\n                oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx);\n            }\n            idxInOld = oldKeyToIdx[newStartVnode.key];\n            if (isUndef(idxInOld)) { // New element        // åˆ›å»ºæ–°çš„èŠ‚ç‚¹åœ¨æ—§èŠ‚ç‚¹çš„æ–°èŠ‚ç‚¹å‰\n                api.insertBefore(parentElm, createElm(newStartVnode, insertedVnodeQueue), oldStartVnode.elm);\n            }\n            else {\n                elmToMove = oldCh[idxInOld];\n                if (elmToMove.sel !== newStartVnode.sel) { // åˆ›å»ºæ–°çš„èŠ‚ç‚¹åœ¨æ—§èŠ‚ç‚¹çš„æ–°èŠ‚ç‚¹å‰\n                    api.insertBefore(parentElm, createElm(newStartVnode, insertedVnodeQueue), oldStartVnode.elm);\n                }\n                else {\n                                                           // åœ¨æ—§èŠ‚ç‚¹æ•°ç»„ä¸­æ‰¾åˆ°ç›¸åŒçš„èŠ‚ç‚¹å°±å¯¹æ¯”å·®å¼‚æ›´æ–°è§†å›¾,ç„¶åç§»åŠ¨ä½ç½®\n                    patchVnode(elmToMove, newStartVnode, insertedVnodeQueue);\n                    oldCh[idxInOld] = undefined;\n                    api.insertBefore(parentElm, elmToMove.elm, oldStartVnode.elm);\n                }\n            }\n            newStartVnode = newCh[++newStartIdx];\n        }\n    }\n    // å¾ªç¯ç»“æŸçš„æ”¶å°¾å·¥ä½œ\n    if (oldStartIdx <= oldEndIdx || newStartIdx <= newEndIdx) {\n        if (oldStartIdx > oldEndIdx) {\n            // newCh[newEndIdx + 1].elmå°±æ˜¯æ—§èŠ‚ç‚¹æ•°ç»„ä¸­çš„ç»“æŸèŠ‚ç‚¹å¯¹åº”çš„domå…ƒç´ \n            // newEndIdx+1æ˜¯å› ä¸ºåœ¨ä¹‹å‰æˆåŠŸåŒ¹é…äº†newEndIdxéœ€è¦-1\n            // newCh[newEndIdx + 1].elm,å› ä¸ºå·²ç»åŒ¹é…è¿‡æœ‰ç›¸åŒçš„èŠ‚ç‚¹äº†,å®ƒå°±æ˜¯ç­‰äºæ—§èŠ‚ç‚¹æ•°ç»„ä¸­çš„ç»“æŸèŠ‚ç‚¹å¯¹åº”çš„domå…ƒç´ (oldCh[oldEndIdx + 1].elm)\n            before = newCh[newEndIdx + 1] == null ? null : newCh[newEndIdx + 1].elm;\n            // æŠŠæ–°èŠ‚ç‚¹æ•°ç»„ä¸­å¤šå‡ºæ¥çš„èŠ‚ç‚¹æ’å…¥åˆ°beforeå‰\n            addVnodes(parentElm, before, newCh, newStartIdx, newEndIdx, insertedVnodeQueue);\n        }\n        else {\n            // è¿™é‡Œå°±æ˜¯æŠŠæ²¡æœ‰åŒ¹é…åˆ°ç›¸åŒèŠ‚ç‚¹çš„èŠ‚ç‚¹åˆ é™¤æ‰\n            removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx);\n        }\n    }\n}\nå¤åˆ¶ä»£ç \n")])])]),n("hr"),e._v(" "),n("h4",{attrs:{id:"keyçš„ä½œç”¨"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keyçš„ä½œç”¨"}},[e._v("#")]),e._v(" keyçš„ä½œç”¨")]),e._v(" "),n("ul",[n("li",[e._v("Diffæ“ä½œå¯ä»¥"),n("code",[e._v("æ›´åŠ å¿«é€Ÿ")]),e._v(";")]),e._v(" "),n("li",[e._v("Diffæ“ä½œå¯ä»¥æ›´åŠ å‡†ç¡®;"),n("code",[e._v("(é¿å…æ¸²æŸ“é”™è¯¯)")])]),e._v(" "),n("li",[n("code",[e._v("ä¸æ¨èä½¿ç”¨ç´¢å¼•")]),e._v("ä½œä¸ºkey")])]),e._v(" "),n("p",[e._v("ä»¥ä¸‹æˆ‘ä»¬çœ‹çœ‹è¿™äº›ä½œç”¨çš„å®ä¾‹:")]),e._v(" "),n("h5",{attrs:{id:"diffæ“ä½œå¯ä»¥æ›´åŠ å‡†ç¡®-é¿å…æ¸²æŸ“é”™è¯¯"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diffæ“ä½œå¯ä»¥æ›´åŠ å‡†ç¡®-é¿å…æ¸²æŸ“é”™è¯¯"}},[e._v("#")]),e._v(" Diffæ“ä½œå¯ä»¥æ›´åŠ å‡†ç¡®;"),n("code",[e._v("(é¿å…æ¸²æŸ“é”™è¯¯)")]),e._v(":")]),e._v(" "),n("p",[e._v("å®ä¾‹:a,b,cä¸‰ä¸ªdomå…ƒç´ ä¸­çš„b,cé—´æ’å…¥ä¸€ä¸ªzå…ƒç´ ")]),e._v(" "),n("p",[e._v("æ²¡æœ‰è®¾ç½®key"),n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLQBlov7cLbsewuYickoDtZ3FLd4nK1icFQnPib2jtradgpQcsLl8laVRibA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("å½“è®¾ç½®äº†key:")]),e._v(" "),n("p",[n("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("h5",{attrs:{id:"diffæ“ä½œå¯ä»¥æ›´åŠ å‡†ç¡®-é¿å…æ¸²æŸ“é”™è¯¯-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diffæ“ä½œå¯ä»¥æ›´åŠ å‡†ç¡®-é¿å…æ¸²æŸ“é”™è¯¯-2"}},[e._v("#")]),e._v(" Diffæ“ä½œå¯ä»¥æ›´åŠ å‡†ç¡®;"),n("code",[e._v("(é¿å…æ¸²æŸ“é”™è¯¯)")])]),e._v(" "),n("p",[e._v("å®ä¾‹:a,b,cä¸‰ä¸ªdomå…ƒç´ ,ä¿®æ”¹äº†aå…ƒç´ çš„æŸä¸ªå±æ€§å†å»åœ¨aå…ƒç´ å‰æ–°å¢ä¸€ä¸ªzå…ƒç´ ")]),e._v(" "),n("p",[e._v("æ²¡æœ‰è®¾ç½®key:")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLicShV9Z6VakI8f5xOAdNRYtmlHNAmqx4UgOAWztdoicryEgImaNiaKTQQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLppGHLibOEHonGxhLfqeNKp2u4vs6vNvg9OwMrSu3cCjOpuQATp8XicMA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("p",[e._v("å› ä¸ºæ²¡æœ‰è®¾ç½®key,é»˜è®¤éƒ½æ˜¯undefined,æ‰€ä»¥èŠ‚ç‚¹éƒ½æ˜¯ç›¸åŒçš„,æ›´æ–°äº†textçš„å†…å®¹ä½†è¿˜æ˜¯æ²¿ç”¨äº†ä¹‹å‰çš„dom,æ‰€ä»¥å®é™…ä¸Š"),n("code",[e._v("a->z(aåŸæœ¬æ‰“å‹¾çš„çŠ¶æ€ä¿ç•™äº†,åªæ”¹å˜äº†text),b->a,c->b,d->c")]),e._v(",éå†å®Œæ¯•å‘ç°è¿˜è¦å¢åŠ ä¸€ä¸ªdom,åœ¨æœ€åæ–°å¢ä¸€ä¸ªtextä¸ºdçš„domå…ƒç´ ")]),e._v(" "),n("p",[e._v("è®¾ç½®äº†key:")]),e._v(" "),n("p",[n("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGL3bJXibeUugGXzPCEDibqhdKqWsibJMibahnicqjfOQfr8JHC5LTSEymKiaGA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("p",[e._v("å½“è®¾ç½®äº†key,a,b,c,déƒ½æœ‰å¯¹åº”çš„key,"),n("code",[e._v("a->a,b->b,c->c,d->d")]),e._v(",å†…å®¹ç›¸åŒæ— éœ€æ›´æ–°,éå†ç»“æŸ,æ–°å¢ä¸€ä¸ªtextä¸ºzçš„domå…ƒç´ ")]),e._v(" "),n("h5",{attrs:{id:"ä¸æ¨èä½¿ç”¨ç´¢å¼•ä½œä¸ºkey"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¸æ¨èä½¿ç”¨ç´¢å¼•ä½œä¸ºkey"}},[e._v("#")]),e._v(" "),n("code",[e._v("ä¸æ¨èä½¿ç”¨ç´¢å¼•")]),e._v("ä½œä¸ºkey:")]),e._v(" "),n("p",[e._v("è®¾ç½®ç´¢å¼•ä¸ºkey:")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLXyG20PYXWkPjWciaFFZPtO6nd3cia8mXE4otXqq1FeYbNb6j0VzFLwyA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("p",[e._v("è¿™æ˜æ˜¾æ•ˆç‡ä¸é«˜,æˆ‘ä»¬åªå¸Œæœ›æ‰¾å‡ºä¸åŒçš„èŠ‚ç‚¹æ›´æ–°,è€Œä½¿ç”¨ç´¢å¼•ä½œä¸ºkeyä¼šå¢åŠ è¿ç®—æ—¶é—´,æˆ‘ä»¬å¯ä»¥æŠŠkeyè®¾ç½®ä¸ºä¸èŠ‚ç‚¹textä¸ºä¸€è‡´å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜:")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHrBPOs1OFIWuxw354WxNWGLdzMXJFmut6AoNtXKorxW9HAbcMsctLKDrsH3z99F79KApCIGHyZ4rA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}}),e._v("image.png")]),e._v(" "),n("hr"),e._v(" "),n("h2",{attrs:{id:"æœ€å"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æœ€å"}},[e._v("#")]),e._v(" æœ€å")]),e._v(" "),n("p",[e._v("å¦‚æœ‰æè¿°é”™è¯¯æˆ–è€…ä¸æ˜çš„åœ°æ–¹è¯·åœ¨ä¸‹æ–¹è¯„è®ºè”ç³»æˆ‘,æˆ‘ä¼šç«‹åˆ»æ›´æ–°,å¦‚æœ‰æ”¶è·,è¯·ä¸ºæˆ‘ç‚¹ä¸ªèµğŸ‘è¿™æ˜¯å¯¹æˆ‘çš„è«å¤§çš„æ”¯æŒ,è°¢è°¢å„ä½")]),e._v(" "),n("p",[e._v("å…³äºæœ¬æ–‡")]),e._v(" "),n("h1",{attrs:{id:"ä½œè€…-æ¸£æ¸£xiong"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä½œè€…-æ¸£æ¸£xiong"}},[e._v("#")]),e._v(" ä½œè€…ï¼šæ¸£æ¸£xiong")]),e._v(" "),n("p",[e._v("https://juejin.cn/post/7000266544181674014")]),e._v(" "),n("p",[e._v("æ¨èé˜…è¯»")]),e._v(" "),n("p",[n("a",{attrs:{href:"http://mp.weixin.qq.com/s?__biz=MzAxODE4MTEzMA==&mid=2650090299&idx=1&sn=d08a44bc38d31855fbd7bf9379ed6562&chksm=83dbb65eb4ac3f485cbc0744b6eb10d179cfddd447a1dbe72aab97a8e323a7ea0939d315bc5e&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("66 é“å‰ç«¯ç®—æ³•é¢è¯•é¢˜é™„æ€è·¯åˆ†æåŠ©ä½ æŸ¥æ¼è¡¥ç¼º"),n("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=o.exports}}]);